
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>Simulation Setup and Management &#8212; ISOLDE 1.0b3.dev7 documentation</title>
    <link rel="stylesheet" href="../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/language_data.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="General Utilities" href="utils.html" />
    <link rel="prev" title="(Semi-)Automated Manipulations" href="scripted_manipulations.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <div class="section" id="simulation-setup-and-management">
<h1>Simulation Setup and Management<a class="headerlink" href="sim_management.html#simulation-setup-and-management" title="Permalink to this headline">¶</a></h1>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><p><a class="reference internal" href="sim_management.html#general-principles" id="id1">General Principles</a></p></li>
<li><p><a class="reference internal" href="sim_management.html#module-chimerax.isolde.openmm" id="id2">Simulation Management Classes</a></p>
<ul>
<li><p><a class="reference internal" href="sim_management.html#simparams" id="id3">SimParams</a></p></li>
<li><p><a class="reference internal" href="sim_management.html#sim-construct" id="id4">Sim_Construct</a></p></li>
<li><p><a class="reference internal" href="sim_management.html#sim-manager" id="id5">Sim_Manager</a></p></li>
<li><p><a class="reference internal" href="sim_management.html#sim-handler" id="id6">Sim_Handler</a></p></li>
<li><p><a class="reference internal" href="sim_management.html#openmm-thread-handler" id="id7">OpenMM_Thread_Handler</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="sim_management.html#custom-forces" id="id8">Custom Forces</a></p>
<ul>
<li><p><a class="reference internal" href="sim_management.html#mdff-potentials" id="id9">MDFF Potentials</a></p></li>
<li><p><a class="reference internal" href="sim_management.html#distance-restraints" id="id10">Distance Restraints</a></p></li>
<li><p><a class="reference internal" href="sim_management.html#position-restraints" id="id11">Position Restraints</a></p></li>
<li><p><a class="reference internal" href="sim_management.html#dihedral-restraints" id="id12">Dihedral Restraints</a></p></li>
<li><p><a class="reference internal" href="sim_management.html#cmap-correction-terms" id="id13">CMAP Correction terms</a></p></li>
<li><p><a class="reference internal" href="sim_management.html#implicit-solvent" id="id14">Implicit Solvent</a></p></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="general-principles">
<h2><a class="toc-backref" href="sim_management.html#id1">General Principles</a><a class="headerlink" href="sim_management.html#general-principles" title="Permalink to this headline">¶</a></h2>
<p>At the heart of ISOLDE’s capabilities is the ability to quickly create an
interactive simulation from an arbitrary selection of residues. In order to
ensure the interface and graphical rendering remain smooth regardless of the
size of the construct, once created most simulation tasks are pushed away to
a separate C++ thread, communicating with ISOLDE in a semi-asynchronous manner.
To be more specific, each call to</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">OpenMM_Thread_Handler</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
</pre></div>
</div>
<p>spawns a C++ thread tasked with running n simulation steps, during which time an
arbitrary number of graphics updates may occur. The thread will terminate after
the desired number of steps, and the simulation will not move forward further
until the next call to <code class="xref py py-func docutils literal notranslate"><span class="pre">step()</span></code>. This prevents the simulation from running
out of control no matter what happens in the GUI.</p>
</div>
<div class="section" id="module-chimerax.isolde.openmm">
<span id="simulation-management-classes"></span><h2><a class="toc-backref" href="sim_management.html#id2">Simulation Management Classes</a><a class="headerlink" href="sim_management.html#module-chimerax.isolde.openmm" title="Permalink to this headline">¶</a></h2>
<div class="section" id="simparams">
<h3><a class="toc-backref" href="sim_management.html#id3">SimParams</a><a class="headerlink" href="sim_management.html#simparams" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><dl class="class">
<dt id="chimerax.isolde.openmm.SimParams">
<em class="property">class </em><code class="sig-prename descclassname">chimerax.isolde.openmm.</code><code class="sig-name descname">SimParams</code><span class="sig-paren">(</span><em class="sig-param">**kw</em><span class="sig-paren">)</span><a class="headerlink" href="sim_management.html#chimerax.isolde.openmm.SimParams" title="Permalink to this definition">¶</a></dt>
<dd><p>Container for all the parameters needed to initialise a simulation.
All parameters in the <code class="xref py py-attr docutils literal notranslate"><span class="pre">_default_params</span></code> dict become properties
when the class is instantiated. Parameters with units are stored as
<code class="xref py py-class docutils literal notranslate"><span class="pre">simtk.Quantity</span></code> instances, and can be retrieved or changed in the
following ways:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">params</span><span class="o">.</span><span class="n">restraint_max_force</span>
    <span class="n">Quantity</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="mf">25000.0</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="n">kilojoule</span><span class="o">/</span><span class="p">(</span><span class="n">nanometer</span><span class="o">*</span><span class="n">mole</span><span class="p">))</span>

<span class="c1"># Assumes the new value is in the stored unit system</span>
<span class="n">params</span><span class="o">.</span><span class="n">restraint_max_force</span> <span class="o">=</span> <span class="mi">20000</span>

<span class="c1"># Automatically converts the value into the stored unit system</span>
<span class="kn">from</span> <span class="nn">simtk.unit</span> <span class="kn">import</span> <span class="n">kilojoule_per_mole</span><span class="p">,</span> <span class="n">angstrom</span>
<span class="n">params</span><span class="o">.</span><span class="n">restraint_max_force</span> <span class="o">=</span> <span class="mi">2000</span> <span class="o">*</span> <span class="n">kilojoule_per_mole</span><span class="o">/</span><span class="n">angstrom</span>

<span class="c1"># Raises an error if you attempt to set a value with incompatible units</span>
<span class="n">params</span><span class="o">.</span><span class="n">restraint_max_force</span> <span class="o">=</span> <span class="mi">2000</span> <span class="o">*</span> <span class="n">kilojoule_per_mole</span>
    <span class="ne">TypeError</span><span class="p">:</span> <span class="n">Unit</span> <span class="s2">&quot;kilojoule/mole&quot;</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">compatible</span> <span class="k">with</span> <span class="n">Unit</span>
    <span class="s2">&quot;kilojoule/(nanometer*mole)&quot;</span><span class="o">.</span>
</pre></div>
</div>
</dd></dl>

</div></blockquote>
</div>
<div class="section" id="sim-construct">
<h3><a class="toc-backref" href="sim_management.html#id4">Sim_Construct</a><a class="headerlink" href="sim_management.html#sim-construct" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><dl class="class">
<dt id="chimerax.isolde.openmm.Sim_Construct">
<em class="property">class </em><code class="sig-prename descclassname">chimerax.isolde.openmm.</code><code class="sig-name descname">Sim_Construct</code><span class="sig-paren">(</span><em class="sig-param">model</em>, <em class="sig-param">mobile_atoms</em>, <em class="sig-param">fixed_atoms</em>, <em class="sig-param">excluded_atoms=None</em><span class="sig-paren">)</span><a class="headerlink" href="sim_management.html#chimerax.isolde.openmm.Sim_Construct" title="Permalink to this definition">¶</a></dt>
<dd><p>Container class defining the ChimeraX atoms (all, mobile and fixed)
in a simulation. Also responsible for storing the visualisation state of
these atoms prior to simulation startup, and reverting it when done.</p>
<dl class="method">
<dt id="chimerax.isolde.openmm.Sim_Construct.__init__">
<code class="sig-name descname">__init__</code><span class="sig-paren">(</span><em class="sig-param">model</em>, <em class="sig-param">mobile_atoms</em>, <em class="sig-param">fixed_atoms</em>, <em class="sig-param">excluded_atoms=None</em><span class="sig-paren">)</span><a class="headerlink" href="sim_management.html#chimerax.isolde.openmm.Sim_Construct.__init__" title="Permalink to this definition">¶</a></dt>
<dd><p>Prepare the construct. The atoms in each array will be sorted in the
same order as <code class="xref py py-attr docutils literal notranslate"><span class="pre">model.residues.atoms</span></code>, primarily because OpenMM
requires atoms to be grouped by residue.</p>
<dl class="simple">
<dt>Args:</dt><dd><ul class="simple">
<li><dl class="simple">
<dt>model:</dt><dd><ul>
<li><p>The <code class="xref py py-class docutils literal notranslate"><span class="pre">chimerax.AtomicStructure</span></code> containing the atoms
in this simulation</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>mobile_atoms:</dt><dd><ul>
<li><p>A <code class="xref py py-class docutils literal notranslate"><span class="pre">chimerax.Atoms</span></code> instance defining the atoms that
are to be mobile</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>fixed_atoms:</dt><dd><ul>
<li><p>A <code class="xref py py-class docutils literal notranslate"><span class="pre">chimerax.Atoms</span></code> instance defining the atoms that
are to be fixed</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>excluded_atoms:</dt><dd><ul>
<li><p>A <code class="xref py py-class docutils literal notranslate"><span class="pre">chimerax.Atoms</span></code> instance defining any atoms to
be excluded from the simulation. This may be set to None.</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</dd>
</dl>
<p>NOTE: the simulation will fail if mobile_atoms and fixed_atoms do not
combine to form a set containing only complete residues. Also note that
OpenMM does not allow a fixed atom to be rigidly bonded to a mobile
one (in practice this means any fixed heavy atom must have its hydrogens
also fixed).</p>
</dd></dl>

<dl class="method">
<dt id="chimerax.isolde.openmm.Sim_Construct.all_atoms">
<em class="property">property </em><code class="sig-name descname">all_atoms</code><a class="headerlink" href="sim_management.html#chimerax.isolde.openmm.Sim_Construct.all_atoms" title="Permalink to this definition">¶</a></dt>
<dd><p>A <code class="xref py py-class docutils literal notranslate"><span class="pre">chimerax.Atoms</span></code> instance containing all atoms in the
simulation, sorted in the same order as <code class="xref py py-attr docutils literal notranslate"><span class="pre">model.residues.atoms</span></code>.</p>
</dd></dl>

<dl class="method">
<dt id="chimerax.isolde.openmm.Sim_Construct.all_residues">
<em class="property">property </em><code class="sig-name descname">all_residues</code><a class="headerlink" href="sim_management.html#chimerax.isolde.openmm.Sim_Construct.all_residues" title="Permalink to this definition">¶</a></dt>
<dd><p>A <code class="xref py py-class docutils literal notranslate"><span class="pre">chimerax.Residues</span></code> instance containing all residues in the
simulation, sorted in the same order as <code class="xref py py-attr docutils literal notranslate"><span class="pre">model.residues</span></code></p>
</dd></dl>

<dl class="method">
<dt id="chimerax.isolde.openmm.Sim_Construct.fixed_atoms">
<em class="property">property </em><code class="sig-name descname">fixed_atoms</code><a class="headerlink" href="sim_management.html#chimerax.isolde.openmm.Sim_Construct.fixed_atoms" title="Permalink to this definition">¶</a></dt>
<dd><p>A <code class="xref py py-class docutils literal notranslate"><span class="pre">chimerax.Atoms</span></code> instance containing the fixed selection,
sorted in the same order as <code class="xref py py-attr docutils literal notranslate"><span class="pre">model.residues.atoms</span></code>.</p>
</dd></dl>

<dl class="method">
<dt id="chimerax.isolde.openmm.Sim_Construct.mobile_atoms">
<em class="property">property </em><code class="sig-name descname">mobile_atoms</code><a class="headerlink" href="sim_management.html#chimerax.isolde.openmm.Sim_Construct.mobile_atoms" title="Permalink to this definition">¶</a></dt>
<dd><p>A <code class="xref py py-class docutils literal notranslate"><span class="pre">chimerax.Atoms</span></code> instance containing the mobile selection,
sorted in the same order as <code class="xref py py-attr docutils literal notranslate"><span class="pre">model.residues.atoms</span></code>.</p>
</dd></dl>

<dl class="method">
<dt id="chimerax.isolde.openmm.Sim_Construct.mobile_heavy_atoms">
<em class="property">property </em><code class="sig-name descname">mobile_heavy_atoms</code><a class="headerlink" href="sim_management.html#chimerax.isolde.openmm.Sim_Construct.mobile_heavy_atoms" title="Permalink to this definition">¶</a></dt>
<dd><p>A <code class="xref py py-class docutils literal notranslate"><span class="pre">chimerax.Atoms</span></code> instance containing the non-hydrogen mobile
atoms, sorted in the same order as <code class="xref py py-attr docutils literal notranslate"><span class="pre">model.residues.atoms</span></code></p>
</dd></dl>

<dl class="method">
<dt id="chimerax.isolde.openmm.Sim_Construct.mobile_residues">
<em class="property">property </em><code class="sig-name descname">mobile_residues</code><a class="headerlink" href="sim_management.html#chimerax.isolde.openmm.Sim_Construct.mobile_residues" title="Permalink to this definition">¶</a></dt>
<dd><p>A <code class="xref py py-class docutils literal notranslate"><span class="pre">chimerax.Residues</span></code> instance containing the mobile residues.</p>
</dd></dl>

<dl class="method">
<dt id="chimerax.isolde.openmm.Sim_Construct.revert_visualisation">
<code class="sig-name descname">revert_visualisation</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="sim_management.html#chimerax.isolde.openmm.Sim_Construct.revert_visualisation" title="Permalink to this definition">¶</a></dt>
<dd><p>Return the model visualisation to the way it was before the simulation
began.</p>
</dd></dl>

<dl class="method">
<dt id="chimerax.isolde.openmm.Sim_Construct.store_original_visualisation">
<code class="sig-name descname">store_original_visualisation</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="sim_management.html#chimerax.isolde.openmm.Sim_Construct.store_original_visualisation" title="Permalink to this definition">¶</a></dt>
<dd><p>Store the current visualisation state of the model, so it can be
reverted once the simulation is done.</p>
</dd></dl>

</dd></dl>

</div></blockquote>
</div>
<div class="section" id="sim-manager">
<h3><a class="toc-backref" href="sim_management.html#id5">Sim_Manager</a><a class="headerlink" href="sim_management.html#sim-manager" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><dl class="class">
<dt id="chimerax.isolde.openmm.Sim_Manager">
<em class="property">class </em><code class="sig-prename descclassname">chimerax.isolde.openmm.</code><code class="sig-name descname">Sim_Manager</code><span class="sig-paren">(</span><em class="sig-param">isolde</em>, <em class="sig-param">model</em>, <em class="sig-param">selected_atoms</em>, <em class="sig-param">isolde_params</em>, <em class="sig-param">sim_params</em>, <em class="sig-param">excluded_residues=None</em>, <em class="sig-param">expansion_mode='extend'</em><span class="sig-paren">)</span><a class="headerlink" href="sim_management.html#chimerax.isolde.openmm.Sim_Manager" title="Permalink to this definition">¶</a></dt>
<dd><p>Responsible for creating the <a class="reference internal" href="sim_management.html#chimerax.isolde.openmm.Sim_Handler" title="chimerax.isolde.openmm.Sim_Handler"><code class="xref py py-class docutils literal notranslate"><span class="pre">Sim_Handler</span></code></a> and managing the
high-level control of the simulation. Handles all the necessary callbacks
for automatically updating restraints in the simulation whenever their
parameters change.</p>
<dl class="method">
<dt id="chimerax.isolde.openmm.Sim_Manager.__init__">
<code class="sig-name descname">__init__</code><span class="sig-paren">(</span><em class="sig-param">isolde</em>, <em class="sig-param">model</em>, <em class="sig-param">selected_atoms</em>, <em class="sig-param">isolde_params</em>, <em class="sig-param">sim_params</em>, <em class="sig-param">excluded_residues=None</em>, <em class="sig-param">expansion_mode='extend'</em><span class="sig-paren">)</span><a class="headerlink" href="sim_management.html#chimerax.isolde.openmm.Sim_Manager.__init__" title="Permalink to this definition">¶</a></dt>
<dd><dl class="simple">
<dt>Prepares a simulation according to the following workflow:</dt><dd><ul class="simple">
<li><p>Expands an initial selection of atoms to complete residues
according to the rules defined by expansion_mode</p></li>
<li><p>Finds a shell of residues around this selection to act as the
fixed context</p></li>
<li><p>Restricts the live validation managers to focus only on the
mobile selection (creating the managers as necessary)</p></li>
<li><p>Finds/creates all restraint managers for the model</p></li>
<li><p>Expands the fixed atom selection to include any non-mobile
residues containing atoms participating in distance restraints
with mobile atoms</p></li>
<li><p>Creates the <a class="reference internal" href="sim_management.html#chimerax.isolde.openmm.Sim_Construct" title="chimerax.isolde.openmm.Sim_Construct"><code class="xref py py-class docutils literal notranslate"><span class="pre">Sim_Construct</span></code></a> object</p></li>
<li><p>Prepares the molecule visualisation for simulation (masking maps
to the mobile selection, hiding atoms not in the simulation, etc.)</p></li>
<li><p>Prepares the MDFF managers (NOTE: this <em>must</em> be done after the
preceding step, which ensures that each <code class="xref py py-class docutils literal notranslate"><span class="pre">chimerax.Volume</span></code>
has a region covering the mobile selection with sufficient padding)</p></li>
<li><p>Prepares all necessary callbacks to update the simulation when
the parameters of restraints, mdff atom proxies etc. change.</p></li>
<li><p>Creates the <a class="reference internal" href="sim_management.html#chimerax.isolde.openmm.Sim_Handler" title="chimerax.isolde.openmm.Sim_Handler"><code class="xref py py-class docutils literal notranslate"><span class="pre">Sim_Handler</span></code></a></p></li>
<li><p>Adds all existing restraints and MDFF atom proxies to the
simulation.</p></li>
</ul>
</dd>
<dt>Args:</dt><dd><ul class="simple">
<li><dl class="simple">
<dt>isolde:</dt><dd><ul>
<li><p>the current isolde session</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>model:</dt><dd><ul>
<li><p>the <code class="xref py py-class docutils literal notranslate"><span class="pre">chimerax.AtomicStructure</span></code> from which the
simulation atoms are drawn</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>selected_atoms:</dt><dd><ul>
<li><dl class="simple">
<dt>a <code class="xref py py-class docutils literal notranslate"><span class="pre">chimerax.Atoms</span></code> instance defining the initial</dt><dd><p>selection around which the simulation will be built.</p>
</dd>
</dl>
</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>isolde_params:</dt><dd><ul>
<li><p>a <code class="xref py py-class docutils literal notranslate"><span class="pre">IsoldeParams</span></code> instance</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>sim_params:</dt><dd><ul>
<li><p>a <a class="reference internal" href="sim_management.html#chimerax.isolde.openmm.SimParams" title="chimerax.isolde.openmm.SimParams"><code class="xref py py-class docutils literal notranslate"><span class="pre">SimParams</span></code></a> instance</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>excluded_residues:</dt><dd><ul>
<li><p>optional <code class="xref py py-class docutils literal notranslate"><span class="pre">chimerax.Residues</span></code> defining residues that
should be excluded from the simulation (typically because
there is no MD parameterisation for them). These will remain
visible in the model and be considered for map calculations,
but will not have any impact whatsoever on simulations. Any
atom(s) directly bonded to an excluded residue will be fixed
in space along with their attendant hydrogen atoms.</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>expansion_mode:</dt><dd><ul>
<li><p>string defining how the initial selection will be expanded.
For allowable options, see <a class="reference internal" href="sim_management.html#chimerax.isolde.openmm.Sim_Manager.expand_mobile_selection" title="chimerax.isolde.openmm.Sim_Manager.expand_mobile_selection"><code class="xref py py-func docutils literal notranslate"><span class="pre">expand_mobile_selection()</span></code></a></p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="chimerax.isolde.openmm.Sim_Manager.checkpoint">
<code class="sig-name descname">checkpoint</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="sim_management.html#chimerax.isolde.openmm.Sim_Manager.checkpoint" title="Permalink to this definition">¶</a></dt>
<dd><p>A <code class="xref py py-class docutils literal notranslate"><span class="pre">CheckPoint</span></code> is a snapshot of the current simulation state
(including the state of all restraints) that can be returned to at any
time, discarding any changes since the checkpoint was saved.</p>
<p><a class="reference internal" href="sim_management.html#chimerax.isolde.openmm.Sim_Manager" title="chimerax.isolde.openmm.Sim_Manager"><code class="xref py py-class docutils literal notranslate"><span class="pre">Sim_Manager</span></code></a> automatically saves a checkpoint when the
simulation is started. This method allows the saving of an intermediate
state - particularly useful before experimenting on an ambiguous
region of your map. Each call to <a class="reference internal" href="sim_management.html#chimerax.isolde.openmm.Sim_Manager.checkpoint" title="chimerax.isolde.openmm.Sim_Manager.checkpoint"><code class="xref py py-func docutils literal notranslate"><span class="pre">checkpoint()</span></code></a> overwrites the
previously-saved one. When ending a simulation you may choose to keep
the final coordinates or revert to either of the last saved checkpoint
or the start-of-simulation checkpoint.</p>
</dd></dl>

<dl class="method">
<dt id="chimerax.isolde.openmm.Sim_Manager.expand_mobile_selection">
<code class="sig-name descname">expand_mobile_selection</code><span class="sig-paren">(</span><em class="sig-param">core_atoms</em>, <em class="sig-param">expansion_mode</em><span class="sig-paren">)</span><a class="headerlink" href="sim_management.html#chimerax.isolde.openmm.Sim_Manager.expand_mobile_selection" title="Permalink to this definition">¶</a></dt>
<dd><p>Expand the set of atoms defined by core_atoms according to a set of
rules. After the initial rule-based expansion, the selection will be
further expanded to encompass all residues coming within
<code class="xref py py-attr docutils literal notranslate"><span class="pre">IsoldeParams.soft_shell_cutoff_distance</span></code> Angstroms of the
expanded selection. The selection returned will always consist of whole
residues.</p>
<dl class="simple">
<dt>Args:</dt><dd><ul class="simple">
<li><dl class="simple">
<dt>core_atoms:</dt><dd><ul>
<li><p>a <code class="xref py py-class docutils literal notranslate"><span class="pre">chimerax.Atoms</span></code> instance</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>expansion_mode:</dt><dd><ul>
<li><p>‘extend’: each contiguous set of residues is extended
backwards and forwards along the chain by the number of
residues set by
<code class="xref py py-attr docutils literal notranslate"><span class="pre">IsoldeParams.num_selection_padding_residues</span></code></p></li>
<li><p>other modes will be added later</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="chimerax.isolde.openmm.Sim_Manager.prepare_sim_visualisation">
<code class="sig-name descname">prepare_sim_visualisation</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="sim_management.html#chimerax.isolde.openmm.Sim_Manager.prepare_sim_visualisation" title="Permalink to this definition">¶</a></dt>
<dd><p>Set up a simulation-friendly visualisation of the construct.</p>
</dd></dl>

<dl class="method">
<dt id="chimerax.isolde.openmm.Sim_Manager.revert_to_checkpoint">
<code class="sig-name descname">revert_to_checkpoint</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="sim_management.html#chimerax.isolde.openmm.Sim_Manager.revert_to_checkpoint" title="Permalink to this definition">¶</a></dt>
<dd><p>Reverts to the last saved checkpoint. If no checkpoint has been manually
saved, reverts to the start of the simulation.</p>
</dd></dl>

<dl class="method">
<dt id="chimerax.isolde.openmm.Sim_Manager.sim_running">
<em class="property">property </em><code class="sig-name descname">sim_running</code><a class="headerlink" href="sim_management.html#chimerax.isolde.openmm.Sim_Manager.sim_running" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns True if the simulation is running, otherwise False. Read only.</p>
</dd></dl>

<dl class="method">
<dt id="chimerax.isolde.openmm.Sim_Manager.start_sim">
<code class="sig-name descname">start_sim</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="sim_management.html#chimerax.isolde.openmm.Sim_Manager.start_sim" title="Permalink to this definition">¶</a></dt>
<dd><p>Start the simulation running. Should only be run once.</p>
</dd></dl>

<dl class="method">
<dt id="chimerax.isolde.openmm.Sim_Manager.stop_sim">
<code class="sig-name descname">stop_sim</code><span class="sig-paren">(</span><em class="sig-param">revert=None</em><span class="sig-paren">)</span><a class="headerlink" href="sim_management.html#chimerax.isolde.openmm.Sim_Manager.stop_sim" title="Permalink to this definition">¶</a></dt>
<dd><p>Stop the simulation and optionally revert to a previous state.</p>
<dl class="simple">
<dt>Args:</dt><dd><ul class="simple">
<li><dl class="simple">
<dt>revert:</dt><dd><ul>
<li><p>None: keep the current coordinates</p></li>
<li><p>‘checkpoint’: revert to the last saved checkpoint</p></li>
<li><p>‘start’: revert to the state the model was in prior to
starting the simulation</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="chimerax.isolde.openmm.Sim_Manager.toggle_pause">
<code class="sig-name descname">toggle_pause</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="sim_management.html#chimerax.isolde.openmm.Sim_Manager.toggle_pause" title="Permalink to this definition">¶</a></dt>
<dd><p>Pause/resume the simulation.</p>
</dd></dl>

</dd></dl>

</div></blockquote>
</div>
<div class="section" id="sim-handler">
<h3><a class="toc-backref" href="sim_management.html#id6">Sim_Handler</a><a class="headerlink" href="sim_management.html#sim-handler" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><dl class="class">
<dt id="chimerax.isolde.openmm.Sim_Handler">
<em class="property">class </em><code class="sig-prename descclassname">chimerax.isolde.openmm.</code><code class="sig-name descname">Sim_Handler</code><span class="sig-paren">(</span><em class="sig-param">session</em>, <em class="sig-param">sim_params</em>, <em class="sig-param">sim_construct</em>, <em class="sig-param">forcefield_mgr</em><span class="sig-paren">)</span><a class="headerlink" href="sim_management.html#chimerax.isolde.openmm.Sim_Handler" title="Permalink to this definition">¶</a></dt>
<dd><p>Responsible for creating a <code class="xref py py-class docutils literal notranslate"><span class="pre">openmm.Simulation</span></code>, instantiating and
populating the custom force objects, managing the creation and calling of
<a class="reference internal" href="sim_management.html#chimerax.isolde.openmm.OpenMM_Thread_Handler" title="chimerax.isolde.openmm.OpenMM_Thread_Handler"><code class="xref py py-class docutils literal notranslate"><span class="pre">OpenMM_Thread_Handler</span></code></a>, and generally handling all the OpenMM
side of simulation management.</p>
<dl class="method">
<dt id="chimerax.isolde.openmm.Sim_Handler.__init__">
<code class="sig-name descname">__init__</code><span class="sig-paren">(</span><em class="sig-param">session</em>, <em class="sig-param">sim_params</em>, <em class="sig-param">sim_construct</em>, <em class="sig-param">forcefield_mgr</em><span class="sig-paren">)</span><a class="headerlink" href="sim_management.html#chimerax.isolde.openmm.Sim_Handler.__init__" title="Permalink to this definition">¶</a></dt>
<dd><p>Prepares the simulation topology parameters and construct, and
initialises the necessary Force objects to handle restraints. Most
restraint forces must be populated using e.g.
<a class="reference internal" href="sim_management.html#chimerax.isolde.openmm.Sim_Handler.add_dihedral_restraints" title="chimerax.isolde.openmm.Sim_Handler.add_dihedral_restraints"><code class="xref py py-func docutils literal notranslate"><span class="pre">add_dihedral_restraints()</span></code></a> before initialising the context and
beginning the simulation. While it is possible to add new restraints
<em>after</em> the simulation has started, in general this is only advisable in
situations where it is impossible or impractical to define all possible
restraints in advance (since each addition requires a costly
reinitialisation of the simulation context). For example, the
performance penalty to having all possible position restraints
pre-defined (and mostly disabled) is minimal, but it is not practical to
pre-define distance restraints between all possible atom pairs.</p>
<dl class="simple">
<dt>Args:</dt><dd><ul class="simple">
<li><dl class="simple">
<dt>session:</dt><dd><ul>
<li><p>the ChimeraX session object</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>sim_params:</dt><dd><ul>
<li><p>a <a class="reference internal" href="sim_management.html#chimerax.isolde.openmm.SimParams" title="chimerax.isolde.openmm.SimParams"><code class="xref py py-class docutils literal notranslate"><span class="pre">SimParams</span></code></a> instance</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>sim_construct:</dt><dd><ul>
<li><p>a <a class="reference internal" href="sim_management.html#chimerax.isolde.openmm.Sim_Construct" title="chimerax.isolde.openmm.Sim_Construct"><code class="xref py py-class docutils literal notranslate"><span class="pre">Sim_Construct</span></code></a> instance</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>forcefield_mgr:</dt><dd><ul>
<li><p>a class that behaves as a
{name: <code class="xref py py-class docutils literal notranslate"><span class="pre">OpenMM::ForceField</span></code>} dict.</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="chimerax.isolde.openmm.Sim_Handler.add_adaptive_distance_restraint">
<code class="sig-name descname">add_adaptive_distance_restraint</code><span class="sig-paren">(</span><em class="sig-param">restraint</em><span class="sig-paren">)</span><a class="headerlink" href="sim_management.html#chimerax.isolde.openmm.Sim_Handler.add_adaptive_distance_restraint" title="Permalink to this definition">¶</a></dt>
<dd><p>Add a single adaptive distance restraint to the simulation. Sets
<code class="xref py py-attr docutils literal notranslate"><span class="pre">sim_index</span></code> for the restraint so it knows its place in the
simulation. Automatically calls <a class="reference internal" href="sim_management.html#chimerax.isolde.openmm.Sim_Handler.context_reinit_needed" title="chimerax.isolde.openmm.Sim_Handler.context_reinit_needed"><code class="xref py py-func docutils literal notranslate"><span class="pre">context_reinit_needed()</span></code></a></p>
<dl class="simple">
<dt>Args:</dt><dd><ul class="simple">
<li><dl class="simple">
<dt>restraint:</dt><dd><ul>
<li><p>a <code class="xref py py-class docutils literal notranslate"><span class="pre">AdaptiveDistanceRestraint</span></code> instance</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="chimerax.isolde.openmm.Sim_Handler.add_adaptive_distance_restraints">
<code class="sig-name descname">add_adaptive_distance_restraints</code><span class="sig-paren">(</span><em class="sig-param">restraints</em><span class="sig-paren">)</span><a class="headerlink" href="sim_management.html#chimerax.isolde.openmm.Sim_Handler.add_adaptive_distance_restraints" title="Permalink to this definition">¶</a></dt>
<dd><p>Add a set of adaptive distance restraints to the simulation. Sets
<code class="xref py py-attr docutils literal notranslate"><span class="pre">sim_index</span></code> for each restraint so it knows its place in the
simulation. Automatically calls <a class="reference internal" href="sim_management.html#chimerax.isolde.openmm.Sim_Handler.context_reinit_needed" title="chimerax.isolde.openmm.Sim_Handler.context_reinit_needed"><code class="xref py py-func docutils literal notranslate"><span class="pre">context_reinit_needed()</span></code></a>.</p>
<dl class="simple">
<dt>Args:</dt><dd><ul class="simple">
<li><dl class="simple">
<dt>restraints:</dt><dd><ul>
<li><p>a <code class="xref py py-class docutils literal notranslate"><span class="pre">AdaptiveDistanceRestraints</span></code> instance</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="chimerax.isolde.openmm.Sim_Handler.add_amber_cmap_torsions">
<code class="sig-name descname">add_amber_cmap_torsions</code><span class="sig-paren">(</span><em class="sig-param">ramas</em><span class="sig-paren">)</span><a class="headerlink" href="sim_management.html#chimerax.isolde.openmm.Sim_Handler.add_amber_cmap_torsions" title="Permalink to this definition">¶</a></dt>
<dd><p>Add CMAP correction terms for AMBER force field.</p>
<dl class="simple">
<dt>Args:</dt><dd><ul class="simple">
<li><dl class="simple">
<dt>ramas:</dt><dd><ul>
<li><p>a <code class="xref py py-class docutils literal notranslate"><span class="pre">Ramas</span></code> instance covering all mobile residues</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="chimerax.isolde.openmm.Sim_Handler.add_dihedral_restraint">
<code class="sig-name descname">add_dihedral_restraint</code><span class="sig-paren">(</span><em class="sig-param">restraint</em><span class="sig-paren">)</span><a class="headerlink" href="sim_management.html#chimerax.isolde.openmm.Sim_Handler.add_dihedral_restraint" title="Permalink to this definition">¶</a></dt>
<dd><p>Singular form of <a class="reference internal" href="sim_management.html#chimerax.isolde.openmm.Sim_Handler.add_dihedral_restraints" title="chimerax.isolde.openmm.Sim_Handler.add_dihedral_restraints"><code class="xref py py-func docutils literal notranslate"><span class="pre">add_dihedral_restraints()</span></code></a>.</p>
<dl class="simple">
<dt>Args:</dt><dd><ul class="simple">
<li><dl class="simple">
<dt>restraint:</dt><dd><ul>
<li><p>A <code class="xref py py-class docutils literal notranslate"><span class="pre">ProperDihedralRestraint</span></code> instance, or any other
Python restraint class based on <code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">Dihedral_Restraint</span></code></p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="chimerax.isolde.openmm.Sim_Handler.add_dihedral_restraints">
<code class="sig-name descname">add_dihedral_restraints</code><span class="sig-paren">(</span><em class="sig-param">restraints</em><span class="sig-paren">)</span><a class="headerlink" href="sim_management.html#chimerax.isolde.openmm.Sim_Handler.add_dihedral_restraints" title="Permalink to this definition">¶</a></dt>
<dd><p>Add a set of dihedral restraints to the simulation. This sets the
<code class="xref py py-attr docutils literal notranslate"><span class="pre">sim_index</span></code> for each restraint so it knows its own place in the
simulation for later updating purposes. Automatically calls
<a class="reference internal" href="sim_management.html#chimerax.isolde.openmm.Sim_Handler.context_reinit_needed" title="chimerax.isolde.openmm.Sim_Handler.context_reinit_needed"><code class="xref py py-func docutils literal notranslate"><span class="pre">context_reinit_needed()</span></code></a>.</p>
<dl class="simple">
<dt>Args:</dt><dd><ul class="simple">
<li><dl class="simple">
<dt>restraints:</dt><dd><ul>
<li><p>Any python restraints <code class="xref py py-class docutils literal notranslate"><span class="pre">chimerax.Collection</span></code> instance
based on <code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">Dihedral_Restraint</span></code>. At present this is
limited to <code class="xref py py-class docutils literal notranslate"><span class="pre">ProperDihedralRestraints</span></code>, but
expect others (e.g. chirals) to be added with time.</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="chimerax.isolde.openmm.Sim_Handler.add_distance_restraint">
<code class="sig-name descname">add_distance_restraint</code><span class="sig-paren">(</span><em class="sig-param">restraint</em><span class="sig-paren">)</span><a class="headerlink" href="sim_management.html#chimerax.isolde.openmm.Sim_Handler.add_distance_restraint" title="Permalink to this definition">¶</a></dt>
<dd><p>Add a single distance restraint to the simulation. Sets
<code class="xref py py-attr docutils literal notranslate"><span class="pre">sim_index</span></code> for the restraint so it knows its place in the
simulation. Automatically calls <a class="reference internal" href="sim_management.html#chimerax.isolde.openmm.Sim_Handler.context_reinit_needed" title="chimerax.isolde.openmm.Sim_Handler.context_reinit_needed"><code class="xref py py-func docutils literal notranslate"><span class="pre">context_reinit_needed()</span></code></a></p>
<dl class="simple">
<dt>Args:</dt><dd><ul class="simple">
<li><dl class="simple">
<dt>restraint:</dt><dd><ul>
<li><p>a <code class="xref py py-class docutils literal notranslate"><span class="pre">DistanceRestraint</span></code> instance</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="chimerax.isolde.openmm.Sim_Handler.add_distance_restraints">
<code class="sig-name descname">add_distance_restraints</code><span class="sig-paren">(</span><em class="sig-param">restraints</em><span class="sig-paren">)</span><a class="headerlink" href="sim_management.html#chimerax.isolde.openmm.Sim_Handler.add_distance_restraints" title="Permalink to this definition">¶</a></dt>
<dd><p>Add a set of distance restraints to the simulation. Sets
<code class="xref py py-attr docutils literal notranslate"><span class="pre">sim_index</span></code> for each restraint so it knows its place in the
simulation. Automatically calls <a class="reference internal" href="sim_management.html#chimerax.isolde.openmm.Sim_Handler.context_reinit_needed" title="chimerax.isolde.openmm.Sim_Handler.context_reinit_needed"><code class="xref py py-func docutils literal notranslate"><span class="pre">context_reinit_needed()</span></code></a></p>
<dl class="simple">
<dt>Args:</dt><dd><ul class="simple">
<li><dl class="simple">
<dt>restraints:</dt><dd><ul>
<li><p>a <code class="xref py py-class docutils literal notranslate"><span class="pre">DistanceRestraints</span></code> instance</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="chimerax.isolde.openmm.Sim_Handler.add_mdff_atom">
<code class="sig-name descname">add_mdff_atom</code><span class="sig-paren">(</span><em class="sig-param">mdff_atom</em>, <em class="sig-param">volume</em><span class="sig-paren">)</span><a class="headerlink" href="sim_management.html#chimerax.isolde.openmm.Sim_Handler.add_mdff_atom" title="Permalink to this definition">¶</a></dt>
<dd><p>Add a singl MDFF atom proxy to the force associated with the given
volume. Automatically calls <a class="reference internal" href="sim_management.html#chimerax.isolde.openmm.Sim_Handler.context_reinit_needed" title="chimerax.isolde.openmm.Sim_Handler.context_reinit_needed"><code class="xref py py-func docutils literal notranslate"><span class="pre">context_reinit_needed()</span></code></a></p>
<dl class="simple">
<dt>Args:</dt><dd><ul class="simple">
<li><dl class="simple">
<dt>mdff_atom:</dt><dd><ul>
<li><p>a <code class="xref py py-class docutils literal notranslate"><span class="pre">MDFFAtom</span></code> instance</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>volume:</dt><dd><ul>
<li><p>the <code class="xref py py-class docutils literal notranslate"><span class="pre">chimerax.Volume</span></code> instance that was used to
create the target force.</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="chimerax.isolde.openmm.Sim_Handler.add_mdff_atoms">
<code class="sig-name descname">add_mdff_atoms</code><span class="sig-paren">(</span><em class="sig-param">mdff_atoms</em>, <em class="sig-param">volume</em><span class="sig-paren">)</span><a class="headerlink" href="sim_management.html#chimerax.isolde.openmm.Sim_Handler.add_mdff_atoms" title="Permalink to this definition">¶</a></dt>
<dd><p>Add a set of MDFF atom proxies to the force associated with the given
volume. Automatically calls <a class="reference internal" href="sim_management.html#chimerax.isolde.openmm.Sim_Handler.context_reinit_needed" title="chimerax.isolde.openmm.Sim_Handler.context_reinit_needed"><code class="xref py py-func docutils literal notranslate"><span class="pre">context_reinit_needed()</span></code></a></p>
<dl class="simple">
<dt>Args:</dt><dd><ul class="simple">
<li><dl class="simple">
<dt>mdff_atoms:</dt><dd><ul>
<li><p>a <code class="xref py py-class docutils literal notranslate"><span class="pre">MDFFAtoms</span></code> instance</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>volume:</dt><dd><ul>
<li><p>the <code class="xref py py-class docutils literal notranslate"><span class="pre">chimerax.Volume</span></code> instance that was used to
create the target force.</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="chimerax.isolde.openmm.Sim_Handler.add_position_restraint">
<code class="sig-name descname">add_position_restraint</code><span class="sig-paren">(</span><em class="sig-param">restraint</em><span class="sig-paren">)</span><a class="headerlink" href="sim_management.html#chimerax.isolde.openmm.Sim_Handler.add_position_restraint" title="Permalink to this definition">¶</a></dt>
<dd><p>Add a single position restraint to the simulation. Sets
<code class="xref py py-attr docutils literal notranslate"><span class="pre">sim_index</span></code> for the restraint so it knows its place in the
simulation. Automatically calls <a class="reference internal" href="sim_management.html#chimerax.isolde.openmm.Sim_Handler.context_reinit_needed" title="chimerax.isolde.openmm.Sim_Handler.context_reinit_needed"><code class="xref py py-func docutils literal notranslate"><span class="pre">context_reinit_needed()</span></code></a></p>
<dl class="simple">
<dt>Args:</dt><dd><ul class="simple">
<li><dl class="simple">
<dt>restraint:</dt><dd><ul>
<li><p>a <code class="xref py py-class docutils literal notranslate"><span class="pre">PositionRestraint</span></code> instance</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="chimerax.isolde.openmm.Sim_Handler.add_position_restraints">
<code class="sig-name descname">add_position_restraints</code><span class="sig-paren">(</span><em class="sig-param">restraints</em><span class="sig-paren">)</span><a class="headerlink" href="sim_management.html#chimerax.isolde.openmm.Sim_Handler.add_position_restraints" title="Permalink to this definition">¶</a></dt>
<dd><p>Add a set of position restraints to the simulation. Sets
<code class="xref py py-attr docutils literal notranslate"><span class="pre">sim_index</span></code> for each restraint so it knows its place in the
simulation. Automatically calls <a class="reference internal" href="sim_management.html#chimerax.isolde.openmm.Sim_Handler.context_reinit_needed" title="chimerax.isolde.openmm.Sim_Handler.context_reinit_needed"><code class="xref py py-func docutils literal notranslate"><span class="pre">context_reinit_needed()</span></code></a></p>
<dl class="simple">
<dt>Args:</dt><dd><ul class="simple">
<li><dl class="simple">
<dt>restraints:</dt><dd><ul>
<li><p>a <code class="xref py py-class docutils literal notranslate"><span class="pre">PositionRestraints</span></code> instance</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="chimerax.isolde.openmm.Sim_Handler.add_tuggable">
<code class="sig-name descname">add_tuggable</code><span class="sig-paren">(</span><em class="sig-param">tuggable</em><span class="sig-paren">)</span><a class="headerlink" href="sim_management.html#chimerax.isolde.openmm.Sim_Handler.add_tuggable" title="Permalink to this definition">¶</a></dt>
<dd><p>Add a single tuggable atom proxy to the simulation. Sets
<code class="xref py py-attr docutils literal notranslate"><span class="pre">sim_index</span></code> so the tuggable knows its place in the simulation.
Automatically calls <a class="reference internal" href="sim_management.html#chimerax.isolde.openmm.Sim_Handler.context_reinit_needed" title="chimerax.isolde.openmm.Sim_Handler.context_reinit_needed"><code class="xref py py-func docutils literal notranslate"><span class="pre">context_reinit_needed()</span></code></a></p>
<dl class="simple">
<dt>Args:</dt><dd><ul class="simple">
<li><dl class="simple">
<dt>tuggable:</dt><dd><ul>
<li><p>a <code class="xref py py-class docutils literal notranslate"><span class="pre">TuggableAtom</span></code> instance</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="chimerax.isolde.openmm.Sim_Handler.add_tuggables">
<code class="sig-name descname">add_tuggables</code><span class="sig-paren">(</span><em class="sig-param">tuggables</em><span class="sig-paren">)</span><a class="headerlink" href="sim_management.html#chimerax.isolde.openmm.Sim_Handler.add_tuggables" title="Permalink to this definition">¶</a></dt>
<dd><p>Add a set of tuggable atom proxies to the simulation. Sets
<code class="xref py py-attr docutils literal notranslate"><span class="pre">sim_index</span></code> for each tuggable so it knows its place in the
simulation. Automatically calls <a class="reference internal" href="sim_management.html#chimerax.isolde.openmm.Sim_Handler.context_reinit_needed" title="chimerax.isolde.openmm.Sim_Handler.context_reinit_needed"><code class="xref py py-func docutils literal notranslate"><span class="pre">context_reinit_needed()</span></code></a></p>
<dl class="simple">
<dt>Args:</dt><dd><ul class="simple">
<li><dl class="simple">
<dt>tuggables:</dt><dd><ul>
<li><p>a <code class="xref py py-class docutils literal notranslate"><span class="pre">TuggableAtoms</span></code> instance</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="chimerax.isolde.openmm.Sim_Handler.context_reinit_needed">
<code class="sig-name descname">context_reinit_needed</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="sim_management.html#chimerax.isolde.openmm.Sim_Handler.context_reinit_needed" title="Permalink to this definition">¶</a></dt>
<dd><p>If the number of particles, bonds etc. in any force object changes, the
context must be reinitialised. Be aware that while reinitialisation
happens in the thread (so GUI performance is not affected), it will
pause the simulation for (typically) a few seconds, so should be saved
for situations where there is no other option. If the simulation has
not yet started this call will be ignored; otherwise the context will
be reinitialised on the next iteration of the main loop.</p>
</dd></dl>

<dl class="method">
<dt id="chimerax.isolde.openmm.Sim_Handler.create_openmm_topology">
<code class="sig-name descname">create_openmm_topology</code><span class="sig-paren">(</span><em class="sig-param">atoms</em>, <em class="sig-param">residue_templates</em><span class="sig-paren">)</span><a class="headerlink" href="sim_management.html#chimerax.isolde.openmm.Sim_Handler.create_openmm_topology" title="Permalink to this definition">¶</a></dt>
<dd><p>Generate a simulation topology from a set of atoms.</p>
<dl class="simple">
<dt>Args:</dt><dd><ul class="simple">
<li><dl class="simple">
<dt>atoms:</dt><dd><ul>
<li><p>a <code class="xref py py-class docutils literal notranslate"><span class="pre">chimerax.Atoms</span></code> instance. Residues must be
complete, and the atoms in each residue must be contiguous
in the array.</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>residue_templates:</dt><dd><ul>
<li><p>A {residue_index: residue_type} dict for residues whose
topology is otherwise ambiguous, where residue_type is the
name of the residue in the forcefield definition. OpenMM
requires a {<code class="xref py py-class docutils literal notranslate"><span class="pre">openmm.Residue</span></code>: residue_type} dict, so
we need to do the conversion here.</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="chimerax.isolde.openmm.Sim_Handler.define_forcefield">
<code class="sig-name descname">define_forcefield</code><span class="sig-paren">(</span><em class="sig-param">forcefield_file_list</em><span class="sig-paren">)</span><a class="headerlink" href="sim_management.html#chimerax.isolde.openmm.Sim_Handler.define_forcefield" title="Permalink to this definition">¶</a></dt>
<dd><p>Create a <code class="xref py py-class docutils literal notranslate"><span class="pre">openmm.ForceField</span></code> object from a set of OpenMM
ffXML files.</p>
<dl class="simple">
<dt>Args:</dt><dd><ul class="simple">
<li><dl class="simple">
<dt>forcefield_file_list:</dt><dd><ul>
<li><p>An iterable of file names.</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="chimerax.isolde.openmm.Sim_Handler.force_update_needed">
<code class="sig-name descname">force_update_needed</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="sim_management.html#chimerax.isolde.openmm.Sim_Handler.force_update_needed" title="Permalink to this definition">¶</a></dt>
<dd><p>This must be called after any changes to force objects to ensure
the changes are pushed to the simulation context. This happens
automatically when changes are made through the <a class="reference internal" href="sim_management.html#chimerax.isolde.openmm.Sim_Manager" title="chimerax.isolde.openmm.Sim_Manager"><code class="xref py py-class docutils literal notranslate"><span class="pre">Sim_Manager</span></code></a>
API.</p>
</dd></dl>

<dl class="method">
<dt id="chimerax.isolde.openmm.Sim_Handler.initialize_adaptive_distance_restraints_force">
<code class="sig-name descname">initialize_adaptive_distance_restraints_force</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="sim_management.html#chimerax.isolde.openmm.Sim_Handler.initialize_adaptive_distance_restraints_force" title="Permalink to this definition">¶</a></dt>
<dd><p>Just initialise the force. Unlike ISOLDE’s other custom forces, this
does not take a max_force argument. Given that the forces applied by
this method should be quite weak under almost all circumstances, this
should not be a problem.</p>
</dd></dl>

<dl class="method">
<dt id="chimerax.isolde.openmm.Sim_Handler.initialize_dihedral_restraint_force">
<code class="sig-name descname">initialize_dihedral_restraint_force</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="sim_management.html#chimerax.isolde.openmm.Sim_Handler.initialize_dihedral_restraint_force" title="Permalink to this definition">¶</a></dt>
<dd><p>Just initialise the restraint force. Must be called before the
simulation starts, and before any restraints are added.</p>
</dd></dl>

<dl class="method">
<dt id="chimerax.isolde.openmm.Sim_Handler.initialize_distance_restraints_force">
<code class="sig-name descname">initialize_distance_restraints_force</code><span class="sig-paren">(</span><em class="sig-param">max_force</em><span class="sig-paren">)</span><a class="headerlink" href="sim_management.html#chimerax.isolde.openmm.Sim_Handler.initialize_distance_restraints_force" title="Permalink to this definition">¶</a></dt>
<dd><p>Just initialise the force, and set its limiting magnitude. Must be called
before the simulation starts, and before any restraints are added.</p>
<dl class="simple">
<dt>Args:</dt><dd><ul class="simple">
<li><dl class="simple">
<dt>max_force:</dt><dd><ul>
<li><p>the maximum allowable force, in <img class="math" src="../_images/math/1d35199d4a4f464e55ae5e1d8f1059180b0eba40.png" alt="kJ mol^{-1} nm^{-1}"/></p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="chimerax.isolde.openmm.Sim_Handler.initialize_implicit_solvent">
<code class="sig-name descname">initialize_implicit_solvent</code><span class="sig-paren">(</span><em class="sig-param">params</em><span class="sig-paren">)</span><a class="headerlink" href="sim_management.html#chimerax.isolde.openmm.Sim_Handler.initialize_implicit_solvent" title="Permalink to this definition">¶</a></dt>
<dd><p>Add a Generalised Born Implicit Solvent (GBIS) formulation.</p>
<dl class="simple">
<dt>Args:</dt><dd><ul class="simple">
<li><dl class="simple">
<dt>params:</dt><dd><ul>
<li><p>a <a class="reference internal" href="sim_management.html#chimerax.isolde.openmm.SimParams" title="chimerax.isolde.openmm.SimParams"><code class="xref py py-class docutils literal notranslate"><span class="pre">SimParams</span></code></a> instance</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="chimerax.isolde.openmm.Sim_Handler.initialize_mdff_force">
<code class="sig-name descname">initialize_mdff_force</code><span class="sig-paren">(</span><em class="sig-param">volume</em><span class="sig-paren">)</span><a class="headerlink" href="sim_management.html#chimerax.isolde.openmm.Sim_Handler.initialize_mdff_force" title="Permalink to this definition">¶</a></dt>
<dd><p>Prepare an MDFF map from a <code class="xref py py-class docutils literal notranslate"><span class="pre">chimerax.Volume</span></code> instance.  The
Volume instance is expected to have a single <code class="xref py py-attr docutils literal notranslate"><span class="pre">region</span></code> applied that
is big enough to cover the expected range of motion of the MDFF atoms
that will be coupled to it (and for performance/memory reasons, ideally
not too much bigger). Must be called before the simulation is started,
and before any MDFF atoms are added.</p>
<dl class="simple">
<dt>Args:</dt><dd><ul class="simple">
<li><dl class="simple">
<dt>volume:</dt><dd><ul>
<li><p>a <code class="xref py py-class docutils literal notranslate"><span class="pre">chimerax.Volume</span></code> instance</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="chimerax.isolde.openmm.Sim_Handler.initialize_mdff_forces">
<code class="sig-name descname">initialize_mdff_forces</code><span class="sig-paren">(</span><em class="sig-param">volumes</em><span class="sig-paren">)</span><a class="headerlink" href="sim_management.html#chimerax.isolde.openmm.Sim_Handler.initialize_mdff_forces" title="Permalink to this definition">¶</a></dt>
<dd><p>Add a <code class="xref py py-class docutils literal notranslate"><span class="pre">LinearInterpMapForce</span></code> for each <code class="xref py py-class docutils literal notranslate"><span class="pre">Volume</span></code>
instance.</p>
<dl class="simple">
<dt>Args:</dt><dd><ul class="simple">
<li><dl class="simple">
<dt>volumes:</dt><dd><ul>
<li><p>an iterable of <code class="xref py py-class docutils literal notranslate"><span class="pre">Volume</span></code> instances</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="chimerax.isolde.openmm.Sim_Handler.initialize_position_restraints_force">
<code class="sig-name descname">initialize_position_restraints_force</code><span class="sig-paren">(</span><em class="sig-param">max_force</em><span class="sig-paren">)</span><a class="headerlink" href="sim_management.html#chimerax.isolde.openmm.Sim_Handler.initialize_position_restraints_force" title="Permalink to this definition">¶</a></dt>
<dd><p>Just initialise the force, and set its limiting magnitude. Must be called
before the simulation starts, and before any restraints are added.</p>
<dl class="simple">
<dt>Args:</dt><dd><ul class="simple">
<li><dl class="simple">
<dt>max_force:</dt><dd><ul>
<li><p>the maximum allowable force, in <img class="math" src="../_images/math/1d35199d4a4f464e55ae5e1d8f1059180b0eba40.png" alt="kJ mol^{-1} nm^{-1}"/></p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="chimerax.isolde.openmm.Sim_Handler.initialize_restraint_forces">
<code class="sig-name descname">initialize_restraint_forces</code><span class="sig-paren">(</span><em class="sig-param">amber_cmap=True</em>, <em class="sig-param">tugging=True</em>, <em class="sig-param">position_restraints=True</em>, <em class="sig-param">distance_restraints=True</em>, <em class="sig-param">dihedral_restraints=True</em>, <em class="sig-param">adaptive_distance_restraints=True</em><span class="sig-paren">)</span><a class="headerlink" href="sim_management.html#chimerax.isolde.openmm.Sim_Handler.initialize_restraint_forces" title="Permalink to this definition">¶</a></dt>
<dd><p>Create the selected Force objects, and add them to the System. No
restraints are added at this stage - these should be added using
(e.g.) add_dihedral_restraints().</p>
<dl class="simple">
<dt>Args:</dt><dd><ul class="simple">
<li><dl class="simple">
<dt>amber_cmap:</dt><dd><ul>
<li><p>use CMAP corrections to the AMBER forcefield as per
<a class="reference external" href="http://pubs.acs.org/doi/pdf/10.1021/acs.jctc.5b00662">http://pubs.acs.org/doi/pdf/10.1021/acs.jctc.5b00662</a>.
Should only be used with the combination of AMBER and
implicit solvent.</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>tugging:</dt><dd><ul>
<li><p>Add interactive tugging force (implemented as a
<code class="xref py py-class docutils literal notranslate"><span class="pre">TopOutRestraintForce</span></code>)</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>position_restraints:</dt><dd><ul>
<li><p>Add position restraints force (implemented as a
<code class="xref py py-class docutils literal notranslate"><span class="pre">TopOutRestraintForce</span></code>)</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>distance_restraints:</dt><dd><ul>
<li><p>Add distance restraints force (implemented as a
<code class="xref py py-class docutils literal notranslate"><span class="pre">TopOutBondForce</span></code>)</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>dihedral_restraints:</dt><dd><ul>
<li><p>Add dihedral restraints force (implemented as a
:py:class:FlatBottomTorsionRestraintForce)</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="chimerax.isolde.openmm.Sim_Handler.initialize_tugging_force">
<code class="sig-name descname">initialize_tugging_force</code><span class="sig-paren">(</span><em class="sig-param">max_force</em><span class="sig-paren">)</span><a class="headerlink" href="sim_management.html#chimerax.isolde.openmm.Sim_Handler.initialize_tugging_force" title="Permalink to this definition">¶</a></dt>
<dd><p>Just initialise the force, and set its limiting magnitude. Must be called
before the simulation starts, and before any restraints are added.</p>
<dl class="simple">
<dt>Args:</dt><dd><ul class="simple">
<li><dl class="simple">
<dt>max_force:</dt><dd><ul>
<li><p>the maximum allowable force, in <img class="math" src="../_images/math/1d35199d4a4f464e55ae5e1d8f1059180b0eba40.png" alt="kJ mol^{-1} nm^{-1}"/></p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="chimerax.isolde.openmm.Sim_Handler.minimize">
<em class="property">property </em><code class="sig-name descname">minimize</code><a class="headerlink" href="sim_management.html#chimerax.isolde.openmm.Sim_Handler.minimize" title="Permalink to this definition">¶</a></dt>
<dd><p>Force the simulation to continue minimizing indefinitely.</p>
</dd></dl>

<dl class="method">
<dt id="chimerax.isolde.openmm.Sim_Handler.pause">
<em class="property">property </em><code class="sig-name descname">pause</code><a class="headerlink" href="sim_management.html#chimerax.isolde.openmm.Sim_Handler.pause" title="Permalink to this definition">¶</a></dt>
<dd><p>Get/set the current pause state.</p>
</dd></dl>

<dl class="method">
<dt id="chimerax.isolde.openmm.Sim_Handler.push_coords_to_sim">
<code class="sig-name descname">push_coords_to_sim</code><span class="sig-paren">(</span><em class="sig-param">coords=None</em><span class="sig-paren">)</span><a class="headerlink" href="sim_management.html#chimerax.isolde.openmm.Sim_Handler.push_coords_to_sim" title="Permalink to this definition">¶</a></dt>
<dd><p>Change the atomic coordinates within the simulation.</p>
<dl class="simple">
<dt>Args:</dt><dd><ul class="simple">
<li><dl class="simple">
<dt>coords:</dt><dd><ul>
<li><p>an array of coordinates in Angstroms, or None. If None, the
current coordinates of the simulation construct in ChimeraX
will be used.</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="chimerax.isolde.openmm.Sim_Handler.release_fixed_atoms">
<code class="sig-name descname">release_fixed_atoms</code><span class="sig-paren">(</span><em class="sig-param">atoms</em><span class="sig-paren">)</span><a class="headerlink" href="sim_management.html#chimerax.isolde.openmm.Sim_Handler.release_fixed_atoms" title="Permalink to this definition">¶</a></dt>
<dd><p>Make the desired fixed atoms mobile again. NOTE: a fixed atom can not be
bonded to a mobile atom via a rigid bond. In most cases this means that
you cannot fix a hydrogen without fixing the heavy atom that it’s bonded
to, and any fixed heavy atom must have all its hydrogens fixed.
While atoms may in theory be fixed and un-fixed during a simulation,
ISOLDE wasn’t built with this in mind and it requires a costly
re-initialisation of the simulation context. In most cases it’s best to
simply use strong position restraints wherever you want to
interactively “fix” atoms.</p>
<dl class="simple">
<dt>Args:</dt><dd><ul class="simple">
<li><dl class="simple">
<dt>atoms:</dt><dd><ul>
<li><p>a <code class="xref py py-class docutils literal notranslate"><span class="pre">chimerax.Atoms</span></code> instance</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="chimerax.isolde.openmm.Sim_Handler.set_fixed_atoms">
<code class="sig-name descname">set_fixed_atoms</code><span class="sig-paren">(</span><em class="sig-param">fixed_atoms</em><span class="sig-paren">)</span><a class="headerlink" href="sim_management.html#chimerax.isolde.openmm.Sim_Handler.set_fixed_atoms" title="Permalink to this definition">¶</a></dt>
<dd><p>Fix the desired atoms rigidly in space. NOTE: a fixed atom can not
be bonded to a mobile atom via a rigid bond. In most cases this means
that you cannot fix a hydrogen without fixing the heavy atom that it’s
bonded to, and any fixed heavy atom must have all its hydrogens fixed.
While atoms may in theory be fixed and un-fixed during a simulation,
ISOLDE wasn’t built with this in mind and it requires a costly
re-initialisation of the simulation context. In most cases it’s best to
simply use strong position restraints wherever you want to
interactively “fix” atoms.</p>
<dl class="simple">
<dt>Args:</dt><dd><ul class="simple">
<li><dl class="simple">
<dt>fixed_atoms:</dt><dd><ul>
<li><p>a <code class="xref py py-class docutils literal notranslate"><span class="pre">chimerax.Atoms</span></code> instance</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="chimerax.isolde.openmm.Sim_Handler.set_mdff_global_k">
<code class="sig-name descname">set_mdff_global_k</code><span class="sig-paren">(</span><em class="sig-param">volume</em>, <em class="sig-param">k</em><span class="sig-paren">)</span><a class="headerlink" href="sim_management.html#chimerax.isolde.openmm.Sim_Handler.set_mdff_global_k" title="Permalink to this definition">¶</a></dt>
<dd><p>Set the global coupling constant for the MDFF force associated with
the given volume. NOTE: this will trigger a reinitialisation of the
simulation context, so use sparingly!</p>
<dl class="simple">
<dt>Args:</dt><dd><ul class="simple">
<li><dl class="simple">
<dt>volume:</dt><dd><ul>
<li><p>the <code class="xref py py-class docutils literal notranslate"><span class="pre">chimerax.Volume</span></code> instance that was used to
create the target force</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>k:</dt><dd><ul>
<li><p>the new coupling constant, in
<img class="math" src="../_images/math/a1b574cc3d28374752015dada4f111a16a8e1dd2.png" alt="kJ mol^{-1} (\text{map density unit})^{-1} nm^3"/></p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="chimerax.isolde.openmm.Sim_Handler.set_mdff_scale_factor">
<code class="sig-name descname">set_mdff_scale_factor</code><span class="sig-paren">(</span><em class="sig-param">volume</em>, <em class="sig-param">scale_factor</em><span class="sig-paren">)</span><a class="headerlink" href="sim_management.html#chimerax.isolde.openmm.Sim_Handler.set_mdff_scale_factor" title="Permalink to this definition">¶</a></dt>
<dd><p>Adjust the dimensions of the mdff map in the simulation. This is
typically used to optimize the scaling in the course of a single
simulation. The final scale should be applied back to the original map,
so that in future simulations the scale factor is 1.0.</p>
<dl class="simple">
<dt>Args:</dt><dd><ul class="simple">
<li><dl class="simple">
<dt>volume:</dt><dd><ul>
<li><p>the <code class="xref py py-class docutils literal notranslate"><span class="pre">chimerax.Volume</span></code> instance that was used to
create the target force</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>scale_factor:</dt><dd><ul>
<li><p>the new scale factor (dimensionless). Changing the scale
factor by more than 1-2% in a single go is dangerous!</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="chimerax.isolde.openmm.Sim_Handler.sim_running">
<em class="property">property </em><code class="sig-name descname">sim_running</code><a class="headerlink" href="sim_management.html#chimerax.isolde.openmm.Sim_Handler.sim_running" title="Permalink to this definition">¶</a></dt>
<dd><p>Is the simulation curently running (i.e. started and not destroyed)?</p>
</dd></dl>

<dl class="method">
<dt id="chimerax.isolde.openmm.Sim_Handler.smoothing">
<em class="property">property </em><code class="sig-name descname">smoothing</code><a class="headerlink" href="sim_management.html#chimerax.isolde.openmm.Sim_Handler.smoothing" title="Permalink to this definition">¶</a></dt>
<dd><p>If true, the displayed coordinates will be a smoothed average of the
last set of equilibration steps. Note that for large values of
sim_steps_per_gui_update this can lead to distorted geometry.</p>
</dd></dl>

<dl class="method">
<dt id="chimerax.isolde.openmm.Sim_Handler.smoothing_alpha">
<em class="property">property </em><code class="sig-name descname">smoothing_alpha</code><a class="headerlink" href="sim_management.html#chimerax.isolde.openmm.Sim_Handler.smoothing_alpha" title="Permalink to this definition">¶</a></dt>
<dd><p>ISOLDE uses an exponential smoothing scheme, where
<a class="reference internal" href="sim_management.html#chimerax.isolde.openmm.Sim_Handler.smoothing_alpha" title="chimerax.isolde.openmm.Sim_Handler.smoothing_alpha"><code class="xref py py-attr docutils literal notranslate"><span class="pre">smoothing_alpha</span></code></a> defines the contribution of each new set of
coordinates to the moving average. Values are limited to the range
(0.01..1), where 1 indicates no smoothing and 0.01 provides extremely
strong smoothing. Values outside of this range will be automatically
clamped. Internally, coordinates are added to the moving  average
every 10 steps or the number of steps to the next graphics  update,
whichever is smaller.</p>
<p>Note that smoothing only affects the <em>visualisation</em> of the simulation,
not the simulation itself. Applying energy minimisation or pausing  the
simulation fetches the latest instantaneous coordinates and restarts the
smoothing.</p>
</dd></dl>

<dl class="method">
<dt id="chimerax.isolde.openmm.Sim_Handler.start_sim">
<code class="sig-name descname">start_sim</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="sim_management.html#chimerax.isolde.openmm.Sim_Handler.start_sim" title="Permalink to this definition">¶</a></dt>
<dd><p>Start the main simulation loop. Automatically runs a minimisation, then
switches to equilibration once minimisation is converged.</p>
</dd></dl>

<dl class="method">
<dt id="chimerax.isolde.openmm.Sim_Handler.stop">
<code class="sig-name descname">stop</code><span class="sig-paren">(</span><em class="sig-param">reason=None</em><span class="sig-paren">)</span><a class="headerlink" href="sim_management.html#chimerax.isolde.openmm.Sim_Handler.stop" title="Permalink to this definition">¶</a></dt>
<dd><p>Stop the simulation. This will destroy the
<code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">OpenMM_Thread_Handler</span></code> object, rendering the Python class
unusable.</p>
</dd></dl>

<dl class="method">
<dt id="chimerax.isolde.openmm.Sim_Handler.temperature">
<em class="property">property </em><code class="sig-name descname">temperature</code><a class="headerlink" href="sim_management.html#chimerax.isolde.openmm.Sim_Handler.temperature" title="Permalink to this definition">¶</a></dt>
<dd><p>Get/set the simulation temperature in Kelvin.</p>
</dd></dl>

<dl class="method">
<dt id="chimerax.isolde.openmm.Sim_Handler.thread_handler">
<em class="property">property </em><code class="sig-name descname">thread_handler</code><a class="headerlink" href="sim_management.html#chimerax.isolde.openmm.Sim_Handler.thread_handler" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns the <a class="reference internal" href="sim_management.html#chimerax.isolde.openmm.OpenMM_Thread_Handler" title="chimerax.isolde.openmm.OpenMM_Thread_Handler"><code class="xref py py-class docutils literal notranslate"><span class="pre">OpenMM_Thread_Handler</span></code></a> object.</p>
</dd></dl>

<dl class="method">
<dt id="chimerax.isolde.openmm.Sim_Handler.toggle_pause">
<code class="sig-name descname">toggle_pause</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="sim_management.html#chimerax.isolde.openmm.Sim_Handler.toggle_pause" title="Permalink to this definition">¶</a></dt>
<dd><p>Pause the simulation if currently running, or resume if paused</p>
</dd></dl>

<dl class="method">
<dt id="chimerax.isolde.openmm.Sim_Handler.triggers">
<em class="property">property </em><code class="sig-name descname">triggers</code><a class="headerlink" href="sim_management.html#chimerax.isolde.openmm.Sim_Handler.triggers" title="Permalink to this definition">¶</a></dt>
<dd><p>A <code class="xref py py-class docutils literal notranslate"><span class="pre">chimerax.TriggerSet</span></code> allowing callbacks to be fired on
key events. See <code class="xref py py-func docutils literal notranslate"><span class="pre">triggers.trigger_names()</span></code> for a list of available
triggers.</p>
</dd></dl>

<dl class="method">
<dt id="chimerax.isolde.openmm.Sim_Handler.update_adaptive_distance_restraint">
<code class="sig-name descname">update_adaptive_distance_restraint</code><span class="sig-paren">(</span><em class="sig-param">restraint</em><span class="sig-paren">)</span><a class="headerlink" href="sim_management.html#chimerax.isolde.openmm.Sim_Handler.update_adaptive_distance_restraint" title="Permalink to this definition">¶</a></dt>
<dd><p>Update the simulation to reflect the current parameters of the given
restraint.</p>
<dl class="simple">
<dt>Args:</dt><dd><ul class="simple">
<li><dl class="simple">
<dt>restraint:</dt><dd><ul>
<li><p>a <code class="xref py py-class docutils literal notranslate"><span class="pre">DistanceRestraint</span></code> instance</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="chimerax.isolde.openmm.Sim_Handler.update_adaptive_distance_restraints">
<code class="sig-name descname">update_adaptive_distance_restraints</code><span class="sig-paren">(</span><em class="sig-param">restraints</em><span class="sig-paren">)</span><a class="headerlink" href="sim_management.html#chimerax.isolde.openmm.Sim_Handler.update_adaptive_distance_restraints" title="Permalink to this definition">¶</a></dt>
<dd><p>Update the simulation to reflect the current parameters of the given
restraints.</p>
<dl class="simple">
<dt>Args:</dt><dd><ul class="simple">
<li><dl class="simple">
<dt>restraints:</dt><dd><ul>
<li><p>a <code class="xref py py-class docutils literal notranslate"><span class="pre">AdaptiveDistanceRestraints</span></code> instance</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="chimerax.isolde.openmm.Sim_Handler.update_dihedral_restraint">
<code class="sig-name descname">update_dihedral_restraint</code><span class="sig-paren">(</span><em class="sig-param">restraint</em><span class="sig-paren">)</span><a class="headerlink" href="sim_management.html#chimerax.isolde.openmm.Sim_Handler.update_dihedral_restraint" title="Permalink to this definition">¶</a></dt>
<dd><p>Update the simulation to match the parameters (target angles,
cutoffs, spring constants and enabled states) of the given restraint.</p>
<dl class="simple">
<dt>Args:</dt><dd><ul class="simple">
<li><dl class="simple">
<dt>restraint:</dt><dd><ul>
<li><p>A <code class="xref py py-class docutils literal notranslate"><span class="pre">ProperDihedralRestraint</span></code> instance. If the
restraint is not part of the current simulation it will be
ignored.</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="chimerax.isolde.openmm.Sim_Handler.update_dihedral_restraints">
<code class="sig-name descname">update_dihedral_restraints</code><span class="sig-paren">(</span><em class="sig-param">restraints</em><span class="sig-paren">)</span><a class="headerlink" href="sim_management.html#chimerax.isolde.openmm.Sim_Handler.update_dihedral_restraints" title="Permalink to this definition">¶</a></dt>
<dd><p>Update the simulation to match the parameters (target angles,
cutoffs, spring constants and enabled states) of the given restraints.</p>
<dl class="simple">
<dt>Args:</dt><dd><ul class="simple">
<li><dl class="simple">
<dt>restraints:</dt><dd><ul>
<li><p>A <code class="xref py py-class docutils literal notranslate"><span class="pre">ProperDihedralRestraints</span></code> instance. Any
restraints that are not part of the current simulation will
be ignored.</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="chimerax.isolde.openmm.Sim_Handler.update_distance_restraint">
<code class="sig-name descname">update_distance_restraint</code><span class="sig-paren">(</span><em class="sig-param">restraint</em><span class="sig-paren">)</span><a class="headerlink" href="sim_management.html#chimerax.isolde.openmm.Sim_Handler.update_distance_restraint" title="Permalink to this definition">¶</a></dt>
<dd><p>Update the simulation to reflect the current parameters (target
distance, spring constant, enabled/disabled state) of the given
restraint.</p>
<dl class="simple">
<dt>Args:</dt><dd><ul class="simple">
<li><dl class="simple">
<dt>restraint:</dt><dd><ul>
<li><p>a <code class="xref py py-class docutils literal notranslate"><span class="pre">DistanceRestraint</span></code> instance</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="chimerax.isolde.openmm.Sim_Handler.update_distance_restraints">
<code class="sig-name descname">update_distance_restraints</code><span class="sig-paren">(</span><em class="sig-param">restraints</em><span class="sig-paren">)</span><a class="headerlink" href="sim_management.html#chimerax.isolde.openmm.Sim_Handler.update_distance_restraints" title="Permalink to this definition">¶</a></dt>
<dd><p>Update the simulation to reflect the current parameters (target
distances, spring constants, enabled/disabled states) of the given
restraints.</p>
<dl class="simple">
<dt>Args:</dt><dd><ul class="simple">
<li><dl class="simple">
<dt>restraints:</dt><dd><ul>
<li><p>a <code class="xref py py-class docutils literal notranslate"><span class="pre">DistanceRestraints</span></code> instance</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="chimerax.isolde.openmm.Sim_Handler.update_mdff_atom">
<code class="sig-name descname">update_mdff_atom</code><span class="sig-paren">(</span><em class="sig-param">mdff_atom</em>, <em class="sig-param">volume</em><span class="sig-paren">)</span><a class="headerlink" href="sim_management.html#chimerax.isolde.openmm.Sim_Handler.update_mdff_atom" title="Permalink to this definition">¶</a></dt>
<dd><p>Update the simulation to reflect the new parameters (individual
coupling constants, enabled/disabled states) for the given MDFF atom
proxy.</p>
<dl class="simple">
<dt>Args:</dt><dd><ul class="simple">
<li><dl class="simple">
<dt>mdff_atom:</dt><dd><ul>
<li><p>a <code class="xref py py-class docutils literal notranslate"><span class="pre">MDFFAtom</span></code> instance</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>volume:</dt><dd><ul>
<li><p>the <code class="xref py py-class docutils literal notranslate"><span class="pre">chimerax.Volume</span></code> instance that was used to
create the target force.</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="chimerax.isolde.openmm.Sim_Handler.update_mdff_atoms">
<code class="sig-name descname">update_mdff_atoms</code><span class="sig-paren">(</span><em class="sig-param">mdff_atoms</em>, <em class="sig-param">volume</em><span class="sig-paren">)</span><a class="headerlink" href="sim_management.html#chimerax.isolde.openmm.Sim_Handler.update_mdff_atoms" title="Permalink to this definition">¶</a></dt>
<dd><p>Update the simulation to reflect the new parameters (individual
coupling constants, enabled/disabled states) for the given MDFF atom
proxies.</p>
<dl class="simple">
<dt>Args:</dt><dd><ul class="simple">
<li><dl class="simple">
<dt>mdff_atoms:</dt><dd><ul>
<li><p>a <code class="xref py py-class docutils literal notranslate"><span class="pre">MDFFAtoms</span></code> instance</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>volume:</dt><dd><ul>
<li><p>the <code class="xref py py-class docutils literal notranslate"><span class="pre">chimerax.Volume</span></code> instance that was used to
create the target force.</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="chimerax.isolde.openmm.Sim_Handler.update_position_restraint">
<code class="sig-name descname">update_position_restraint</code><span class="sig-paren">(</span><em class="sig-param">restraint</em><span class="sig-paren">)</span><a class="headerlink" href="sim_management.html#chimerax.isolde.openmm.Sim_Handler.update_position_restraint" title="Permalink to this definition">¶</a></dt>
<dd><p>Update the simulation to reflect the current parameters (target
position, spring constant, enabled/disabled state) of the given
restraint.</p>
<dl class="simple">
<dt>Args:</dt><dd><ul class="simple">
<li><dl class="simple">
<dt>restraint:</dt><dd><ul>
<li><p>a <code class="xref py py-class docutils literal notranslate"><span class="pre">PositionRestraint</span></code> instance</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="chimerax.isolde.openmm.Sim_Handler.update_position_restraints">
<code class="sig-name descname">update_position_restraints</code><span class="sig-paren">(</span><em class="sig-param">restraints</em><span class="sig-paren">)</span><a class="headerlink" href="sim_management.html#chimerax.isolde.openmm.Sim_Handler.update_position_restraints" title="Permalink to this definition">¶</a></dt>
<dd><p>Update the simulation to reflect the current parameters (target
positions, spring constants, enabled/disabled states) of the given
restraints.</p>
<dl class="simple">
<dt>Args:</dt><dd><ul class="simple">
<li><dl class="simple">
<dt>restraints:</dt><dd><ul>
<li><p>a <code class="xref py py-class docutils literal notranslate"><span class="pre">PositionRestraints</span></code> instance</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="chimerax.isolde.openmm.Sim_Handler.update_tuggable">
<code class="sig-name descname">update_tuggable</code><span class="sig-paren">(</span><em class="sig-param">tuggable</em><span class="sig-paren">)</span><a class="headerlink" href="sim_management.html#chimerax.isolde.openmm.Sim_Handler.update_tuggable" title="Permalink to this definition">¶</a></dt>
<dd><p>Update the simulation to reflect the current parameters (target
positions, spring constants, enabled/disabled states) of the given
tuggable.</p>
<dl class="simple">
<dt>Args:</dt><dd><ul class="simple">
<li><dl class="simple">
<dt>tuggable:</dt><dd><ul>
<li><p>a <code class="xref py py-class docutils literal notranslate"><span class="pre">TuggableAtom</span></code> instance</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="chimerax.isolde.openmm.Sim_Handler.update_tuggables">
<code class="sig-name descname">update_tuggables</code><span class="sig-paren">(</span><em class="sig-param">tuggables</em><span class="sig-paren">)</span><a class="headerlink" href="sim_management.html#chimerax.isolde.openmm.Sim_Handler.update_tuggables" title="Permalink to this definition">¶</a></dt>
<dd><p>Update the simulation to reflect the current parameters (target
positions, spring constants, enabled/disabled states) of the given
tuggables.</p>
<dl class="simple">
<dt>Args:</dt><dd><ul class="simple">
<li><dl class="simple">
<dt>tuggables:</dt><dd><ul>
<li><p>a <code class="xref py py-class docutils literal notranslate"><span class="pre">TuggableAtoms</span></code> instance</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</dd>
</dl>
</dd></dl>

</dd></dl>

</div></blockquote>
</div>
<div class="section" id="openmm-thread-handler">
<h3><a class="toc-backref" href="sim_management.html#id7">OpenMM_Thread_Handler</a><a class="headerlink" href="sim_management.html#openmm-thread-handler" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><dl class="class">
<dt id="chimerax.isolde.openmm.OpenMM_Thread_Handler">
<em class="property">class </em><code class="sig-prename descclassname">chimerax.isolde.openmm.</code><code class="sig-name descname">OpenMM_Thread_Handler</code><span class="sig-paren">(</span><em class="sig-param">context</em>, <em class="sig-param">params</em>, <em class="sig-param">c_pointer=None</em><span class="sig-paren">)</span><a class="headerlink" href="sim_management.html#chimerax.isolde.openmm.OpenMM_Thread_Handler" title="Permalink to this definition">¶</a></dt>
<dd><p>A lightweight wrapper class for a <code class="xref py py-class docutils literal notranslate"><span class="pre">openmm.Context</span></code>, which
pushes time-consuming tasks off to a C++ thread so that Python performance
is not interrupted. Each call to <a class="reference internal" href="sim_management.html#chimerax.isolde.openmm.OpenMM_Thread_Handler.step" title="chimerax.isolde.openmm.OpenMM_Thread_Handler.step"><code class="xref py py-func docutils literal notranslate"><span class="pre">step()</span></code></a> or <a class="reference internal" href="sim_management.html#chimerax.isolde.openmm.OpenMM_Thread_Handler.minimize" title="chimerax.isolde.openmm.OpenMM_Thread_Handler.minimize"><code class="xref py py-func docutils literal notranslate"><span class="pre">minimize()</span></code></a> will
create a short-lived thread to run the desired number of steps or a round of
minimization, respectively. Where necessary (e.g. where new  restraints are
added to the simulation), the context may be reinitialised  with
<a class="reference internal" href="sim_management.html#chimerax.isolde.openmm.OpenMM_Thread_Handler.reinitialize_context_and_keep_state" title="chimerax.isolde.openmm.OpenMM_Thread_Handler.reinitialize_context_and_keep_state"><code class="xref py py-func docutils literal notranslate"><span class="pre">reinitialize_context_and_keep_state()</span></code></a>. The status of the thread can be
checked with <a class="reference internal" href="sim_management.html#chimerax.isolde.openmm.OpenMM_Thread_Handler.thread_finished" title="chimerax.isolde.openmm.OpenMM_Thread_Handler.thread_finished"><code class="xref py py-attr docutils literal notranslate"><span class="pre">thread_finished</span></code></a>, while the initial and final
coordinates can be retrieved with <a class="reference internal" href="sim_management.html#chimerax.isolde.openmm.OpenMM_Thread_Handler.last_coords" title="chimerax.isolde.openmm.OpenMM_Thread_Handler.last_coords"><code class="xref py py-attr docutils literal notranslate"><span class="pre">last_coords</span></code></a> and <a class="reference internal" href="sim_management.html#chimerax.isolde.openmm.OpenMM_Thread_Handler.coords" title="chimerax.isolde.openmm.OpenMM_Thread_Handler.coords"><code class="xref py py-attr docutils literal notranslate"><span class="pre">coords</span></code></a>
respectively. Within the thread, the simulation is checked for excessive
velocities every 10 steps. If instability (overly fast-moving atoms) is
detected, the thread will terminate early and <a class="reference internal" href="sim_management.html#chimerax.isolde.openmm.OpenMM_Thread_Handler.unstable" title="chimerax.isolde.openmm.OpenMM_Thread_Handler.unstable"><code class="xref py py-attr docutils literal notranslate"><span class="pre">unstable</span></code></a> will be set
to True. In such cases it is advisable to run one or more minimization
rounds. When minimization converges to within tolerance, <cite>unstable</cite> will be
reset to False.</p>
<p>Use with care! While nothing prevents you from using the standard single-
thread OpenMM API alongside this one, it is up to you to ensure that no
threads are running before making any calls that affect the simulation.
Additionally, the <a class="reference internal" href="sim_management.html#chimerax.isolde.openmm.OpenMM_Thread_Handler" title="chimerax.isolde.openmm.OpenMM_Thread_Handler"><code class="xref py py-class docutils literal notranslate"><span class="pre">OpenMM_Thread_Handler</span></code></a> object <em>must</em> be destroyed
before the <code class="xref py py-class docutils literal notranslate"><span class="pre">openmm.Context</span></code> it is attached to.</p>
<dl class="method">
<dt id="chimerax.isolde.openmm.OpenMM_Thread_Handler.__init__">
<code class="sig-name descname">__init__</code><span class="sig-paren">(</span><em class="sig-param">context</em>, <em class="sig-param">params</em>, <em class="sig-param">c_pointer=None</em><span class="sig-paren">)</span><a class="headerlink" href="sim_management.html#chimerax.isolde.openmm.OpenMM_Thread_Handler.__init__" title="Permalink to this definition">¶</a></dt>
<dd><p>Initialise the thread handler.</p>
<dl class="simple">
<dt>Args:</dt><dd><ul class="simple">
<li><dl class="simple">
<dt>context:</dt><dd><ul>
<li><p>a <code class="xref py py-class docutils literal notranslate"><span class="pre">openmm.Context</span></code> instance</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="chimerax.isolde.openmm.OpenMM_Thread_Handler.clashing">
<em class="property">property </em><code class="sig-name descname">clashing</code><a class="headerlink" href="sim_management.html#chimerax.isolde.openmm.OpenMM_Thread_Handler.clashing" title="Permalink to this definition">¶</a></dt>
<dd><p>True if any atom is experiencing an extreme force after energy
minimisation.</p>
</dd></dl>

<dl class="method">
<dt id="chimerax.isolde.openmm.OpenMM_Thread_Handler.coords">
<em class="property">property </em><code class="sig-name descname">coords</code><a class="headerlink" href="sim_management.html#chimerax.isolde.openmm.OpenMM_Thread_Handler.coords" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns the coordinates of the atoms after the most recent thread
completes. Can also be set, to push edited coordinates back to the
simulation.</p>
</dd></dl>

<dl class="method">
<dt id="chimerax.isolde.openmm.OpenMM_Thread_Handler.cpp_pointer">
<em class="property">property </em><code class="sig-name descname">cpp_pointer</code><a class="headerlink" href="sim_management.html#chimerax.isolde.openmm.OpenMM_Thread_Handler.cpp_pointer" title="Permalink to this definition">¶</a></dt>
<dd><p>Value that can be passed to C++ layer to be used as pointer (Python int)</p>
</dd></dl>

<dl class="method">
<dt id="chimerax.isolde.openmm.OpenMM_Thread_Handler.deleted">
<em class="property">property </em><code class="sig-name descname">deleted</code><a class="headerlink" href="sim_management.html#chimerax.isolde.openmm.OpenMM_Thread_Handler.deleted" title="Permalink to this definition">¶</a></dt>
<dd><p>Has the C++ side been deleted?</p>
</dd></dl>

<dl class="method">
<dt id="chimerax.isolde.openmm.OpenMM_Thread_Handler.finalize_thread">
<code class="sig-name descname">finalize_thread</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="sim_management.html#chimerax.isolde.openmm.OpenMM_Thread_Handler.finalize_thread" title="Permalink to this definition">¶</a></dt>
<dd><p>Wrap up and join the existing thread. Note that if the thread has not
finished, Python and GUI will hang until it has.</p>
</dd></dl>

<dl class="method">
<dt id="chimerax.isolde.openmm.OpenMM_Thread_Handler.last_coords">
<em class="property">property </em><code class="sig-name descname">last_coords</code><a class="headerlink" href="sim_management.html#chimerax.isolde.openmm.OpenMM_Thread_Handler.last_coords" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns the coordinates of the atoms as they were at the start of the
most recent thread. Switching between these and the final coords can
be useful for diagnosing instability.</p>
</dd></dl>

<dl class="method">
<dt id="chimerax.isolde.openmm.OpenMM_Thread_Handler.min_thread_period">
<em class="property">property </em><code class="sig-name descname">min_thread_period</code><a class="headerlink" href="sim_management.html#chimerax.isolde.openmm.OpenMM_Thread_Handler.min_thread_period" title="Permalink to this definition">¶</a></dt>
<dd><p>Throttle the simulation to a minimum time period per loop (in ms).
Useful when graphics performance needs to be prioritised over simulation
performance. The default value is 1.0, which in almost all situations
means the simulation will not be throttled.</p>
</dd></dl>

<dl class="method">
<dt id="chimerax.isolde.openmm.OpenMM_Thread_Handler.minimize">
<code class="sig-name descname">minimize</code><span class="sig-paren">(</span><em class="sig-param">tolerance=None</em>, <em class="sig-param">max_iterations=None</em><span class="sig-paren">)</span><a class="headerlink" href="sim_management.html#chimerax.isolde.openmm.OpenMM_Thread_Handler.minimize" title="Permalink to this definition">¶</a></dt>
<dd><p>Run an energy minimization on the coordinates. If the minimisation
converges to within tolerance, unstable will be set to False.
Don’t forget to run <a class="reference internal" href="sim_management.html#chimerax.isolde.openmm.OpenMM_Thread_Handler.reinitialize_velocities" title="chimerax.isolde.openmm.OpenMM_Thread_Handler.reinitialize_velocities"><code class="xref py py-func docutils literal notranslate"><span class="pre">reinitialize_velocities()</span></code></a> before continuing
equilibration!</p>
<dl class="simple">
<dt>Args:</dt><dd><ul class="simple">
<li><dl class="simple">
<dt>tolerance:</dt><dd><ul>
<li><p>Convergence tolerance, in kJ/mol/atom.</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>max_iterations:</dt><dd><ul>
<li><p>Maximum number of iterations to run for before returning
coordinates. NOTE: minimisation runs best if this number is
kept large (at least a few hundred).</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="chimerax.isolde.openmm.OpenMM_Thread_Handler.natoms">
<em class="property">property </em><code class="sig-name descname">natoms</code><a class="headerlink" href="sim_management.html#chimerax.isolde.openmm.OpenMM_Thread_Handler.natoms" title="Permalink to this definition">¶</a></dt>
<dd><p>Number of atoms in the simulation.</p>
</dd></dl>

<dl class="method">
<dt id="chimerax.isolde.openmm.OpenMM_Thread_Handler.reinitialize_context_and_keep_state">
<code class="sig-name descname">reinitialize_context_and_keep_state</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="sim_management.html#chimerax.isolde.openmm.OpenMM_Thread_Handler.reinitialize_context_and_keep_state" title="Permalink to this definition">¶</a></dt>
<dd><p>Reinitialize the Context, keeping the current positions and velocities.
A reinitialization is typically only required when the number of
bonds/particles in a Force object changes.</p>
</dd></dl>

<dl class="method">
<dt id="chimerax.isolde.openmm.OpenMM_Thread_Handler.reinitialize_velocities">
<code class="sig-name descname">reinitialize_velocities</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="sim_management.html#chimerax.isolde.openmm.OpenMM_Thread_Handler.reinitialize_velocities" title="Permalink to this definition">¶</a></dt>
<dd><p>Set the atomic velocities to random values consistent with the current
temperature. Recommended after any energy minimisation.</p>
</dd></dl>

<dl class="method">
<dt id="chimerax.isolde.openmm.OpenMM_Thread_Handler.smoothing">
<em class="property">property </em><code class="sig-name descname">smoothing</code><a class="headerlink" href="sim_management.html#chimerax.isolde.openmm.OpenMM_Thread_Handler.smoothing" title="Permalink to this definition">¶</a></dt>
<dd><p>If true, the displayed coordinates will be a smoothed average of the
last set of equilibration steps. Note that for large values of
sim_steps_per_gui_update this can lead to distorted geometry.</p>
</dd></dl>

<dl class="method">
<dt id="chimerax.isolde.openmm.OpenMM_Thread_Handler.smoothing_alpha">
<em class="property">property </em><code class="sig-name descname">smoothing_alpha</code><a class="headerlink" href="sim_management.html#chimerax.isolde.openmm.OpenMM_Thread_Handler.smoothing_alpha" title="Permalink to this definition">¶</a></dt>
<dd><p>ISOLDE uses an exponential smoothing scheme, where
<a class="reference internal" href="sim_management.html#chimerax.isolde.openmm.OpenMM_Thread_Handler.smoothing_alpha" title="chimerax.isolde.openmm.OpenMM_Thread_Handler.smoothing_alpha"><code class="xref py py-attr docutils literal notranslate"><span class="pre">smoothing_alpha</span></code></a> defines the contribution of each new set of
coordinates to the moving average. Values are limited to the range
(0.01..1), where 1 indicates no smoothing and 0.01 provides extremely
strong smoothing. Values outside of this range will be automatically
clamped. Internally, coordinates are added to the moving  average
every 10 steps or the number of steps to the next graphics  update,
whichever is smaller.</p>
<p>Note that smoothing only affects the <em>visualisation</em> of the simulation,
not the simulation itself. Applying energy minimisation or pausing  the
simulation fetches the latest instantaneous coordinates and restarts the
smoothing.</p>
</dd></dl>

<dl class="method">
<dt id="chimerax.isolde.openmm.OpenMM_Thread_Handler.step">
<code class="sig-name descname">step</code><span class="sig-paren">(</span><em class="sig-param">steps</em><span class="sig-paren">)</span><a class="headerlink" href="sim_management.html#chimerax.isolde.openmm.OpenMM_Thread_Handler.step" title="Permalink to this definition">¶</a></dt>
<dd><p>Advance the simulation integrator by the desired number of steps.</p>
<dl class="simple">
<dt>Args:</dt><dd><ul class="simple">
<li><dl class="simple">
<dt>steps:</dt><dd><ul>
<li><p>an integer value</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="chimerax.isolde.openmm.OpenMM_Thread_Handler.thread_finished">
<code class="sig-name descname">thread_finished</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="sim_management.html#chimerax.isolde.openmm.OpenMM_Thread_Handler.thread_finished" title="Permalink to this definition">¶</a></dt>
<dd><p>Has the current thread finished its task?</p>
</dd></dl>

<dl class="method">
<dt id="chimerax.isolde.openmm.OpenMM_Thread_Handler.unstable">
<code class="sig-name descname">unstable</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="sim_management.html#chimerax.isolde.openmm.OpenMM_Thread_Handler.unstable" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns true if any atoms in the simulation are moving too fast.</p>
</dd></dl>

<dl class="method">
<dt id="chimerax.isolde.openmm.OpenMM_Thread_Handler.unstable_atoms">
<em class="property">property </em><code class="sig-name descname">unstable_atoms</code><a class="headerlink" href="sim_management.html#chimerax.isolde.openmm.OpenMM_Thread_Handler.unstable_atoms" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns a Boolean mask indicating which atoms are currently moving too
fast.</p>
</dd></dl>

</dd></dl>

</div></blockquote>
</div>
</div>
<div class="section" id="custom-forces">
<h2><a class="toc-backref" href="sim_management.html#id8">Custom Forces</a><a class="headerlink" href="sim_management.html#custom-forces" title="Permalink to this headline">¶</a></h2>
<p>The actual custom OpenMM force classes used to implement MDFF and the various
interactive restraints are listed below.</p>
<span class="target" id="module-chimerax.isolde.openmm.custom_forces"></span><div class="section" id="mdff-potentials">
<h3><a class="toc-backref" href="sim_management.html#id9">MDFF Potentials</a><a class="headerlink" href="sim_management.html#mdff-potentials" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><dl class="class">
<dt id="chimerax.isolde.openmm.custom_forces.CubicInterpMapForce">
<em class="property">class </em><code class="sig-prename descclassname">chimerax.isolde.openmm.custom_forces.</code><code class="sig-name descname">CubicInterpMapForce</code><span class="sig-paren">(</span><em class="sig-param">data</em>, <em class="sig-param">xyz_to_ijk_transform</em>, <em class="sig-param">suffix</em>, <em class="sig-param">units='angstroms'</em><span class="sig-paren">)</span><a class="headerlink" href="sim_management.html#chimerax.isolde.openmm.custom_forces.CubicInterpMapForce" title="Permalink to this definition">¶</a></dt>
<dd><p>Converts a map of (i,j,k) data and a (x,y,z)-&gt;(i,j,k) transformation
matrix to a potential energy field, with tricubic interpolation of values.</p>
<dl class="method">
<dt id="chimerax.isolde.openmm.custom_forces.CubicInterpMapForce.__init__">
<code class="sig-name descname">__init__</code><span class="sig-paren">(</span><em class="sig-param">data</em>, <em class="sig-param">xyz_to_ijk_transform</em>, <em class="sig-param">suffix</em>, <em class="sig-param">units='angstroms'</em><span class="sig-paren">)</span><a class="headerlink" href="sim_management.html#chimerax.isolde.openmm.custom_forces.CubicInterpMapForce.__init__" title="Permalink to this definition">¶</a></dt>
<dd><p>For a given atom at (x,y,z), the map potential will be defined
as:</p>
<div class="math">
<p><img src="../_images/math/278613779a559d41cc08ce57d18d70941055ea50.png" alt="global_k * individual_k * pot_xyz"/></p>
</div><p>where <cite>pot_xyz</cite> is calculated by linear interpolation from the
(i,j,k) map grid after applying <cite>xyz_to_ijk_transform</cite>.</p>
<dl class="simple">
<dt>Args:</dt><dd><ul class="simple">
<li><dl class="simple">
<dt>data:</dt><dd><ul>
<li><p>The map data as a 3D (i,j,k) NumPy array in C-style order</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>xyz_to_ijk_transform:</dt><dd><ul>
<li><p>A NumPy 3x4 float array defining the transformation matrix
mapping (x,y,z) coordinates to (i,j,k)</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>suffix:</dt><dd><ul>
<li><p>In OpenMM, global parameters are global to the <em>entire
context</em>, not just to the force. To provide a global
parameter unique to this instance, the suffix is appended
to the base name of the parameter. Should be a unique string.</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>units:</dt><dd><ul>
<li><p>The units in which the transformation matrix is defined.
Either ‘angstroms’ or ‘nanometers’</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="chimerax.isolde.openmm.custom_forces.CubicInterpMapForce_Low_Memory">
<em class="property">class </em><code class="sig-prename descclassname">chimerax.isolde.openmm.custom_forces.</code><code class="sig-name descname">CubicInterpMapForce_Low_Memory</code><span class="sig-paren">(</span><em class="sig-param">data</em>, <em class="sig-param">xyz_to_ijk_transform</em>, <em class="sig-param">suffix</em>, <em class="sig-param">units='angstroms'</em><span class="sig-paren">)</span><a class="headerlink" href="sim_management.html#chimerax.isolde.openmm.custom_forces.CubicInterpMapForce_Low_Memory" title="Permalink to this definition">¶</a></dt>
<dd><p>The Continuous3DFunction pre-calculates the 64 coefficients per voxel
necessary to quickly interpolate anywhere in the volume. This makes it
extremely fast, but the coefficients are stored on the GPU as a single 1D
array. In both OpenCL and CUDA, the size of a single array is limited to
(signed) INTMAX = 2**31-1 bytes - allowing a maximum of just over 8M voxels.
Beyond that, we need to fall back to the slower but more memory-efficient
approach of recalculating the interpolation coefficients as needed.</p>
<dl class="method">
<dt id="chimerax.isolde.openmm.custom_forces.CubicInterpMapForce_Low_Memory.__init__">
<code class="sig-name descname">__init__</code><span class="sig-paren">(</span><em class="sig-param">data</em>, <em class="sig-param">xyz_to_ijk_transform</em>, <em class="sig-param">suffix</em>, <em class="sig-param">units='angstroms'</em><span class="sig-paren">)</span><a class="headerlink" href="sim_management.html#chimerax.isolde.openmm.custom_forces.CubicInterpMapForce_Low_Memory.__init__" title="Permalink to this definition">¶</a></dt>
<dd><p>For a given atom at (x,y,z), the map potential will be defined
as:</p>
<div class="math">
<p><img src="../_images/math/278613779a559d41cc08ce57d18d70941055ea50.png" alt="global_k * individual_k * pot_xyz"/></p>
</div><p>where <cite>pot_xyz</cite> is calculated by tricubic interpolation from the
(i,j,k) map grid after applying <cite>xyz_to_ijk_transform</cite>.</p>
<dl class="simple">
<dt>Args:</dt><dd><ul class="simple">
<li><dl class="simple">
<dt>data:</dt><dd><ul>
<li><p>The map data as a 3D (i,j,k) NumPy array in C-style order</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>xyz_to_ijk_transform:</dt><dd><ul>
<li><p>A NumPy 3x4 float array defining the transformation matrix
mapping (x,y,z) coordinates to (i,j,k)</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>suffix:</dt><dd><ul>
<li><p>In OpenMM, global parameters are global to the <em>entire
context</em>, not just to the force. To provide a global
parameter unique to this instance, the suffix is appended
to the base name of the parameter. Should be a unique string.</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>units:</dt><dd><ul>
<li><p>The units in which the transformation matrix is defined.
Either ‘angstroms’ or ‘nanometers’</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="chimerax.isolde.openmm.custom_forces.LinearInterpMapForce">
<em class="property">class </em><code class="sig-prename descclassname">chimerax.isolde.openmm.custom_forces.</code><code class="sig-name descname">LinearInterpMapForce</code><span class="sig-paren">(</span><em class="sig-param">data</em>, <em class="sig-param">xyz_to_ijk_transform</em>, <em class="sig-param">suffix</em>, <em class="sig-param">units='angstroms'</em><span class="sig-paren">)</span><a class="headerlink" href="sim_management.html#chimerax.isolde.openmm.custom_forces.LinearInterpMapForce" title="Permalink to this definition">¶</a></dt>
<dd><p>NOTE: This class is deprecated, since there is almost no situation in which
it is superior to either <a class="reference internal" href="sim_management.html#chimerax.isolde.openmm.custom_forces.CubicInterpMapForce" title="chimerax.isolde.openmm.custom_forces.CubicInterpMapForce"><code class="xref py py-class docutils literal notranslate"><span class="pre">CubicInterpMapForce</span></code></a> or
<a class="reference internal" href="sim_management.html#chimerax.isolde.openmm.custom_forces.CubicInterpMapForce_Low_Memory" title="chimerax.isolde.openmm.custom_forces.CubicInterpMapForce_Low_Memory"><code class="xref py py-class docutils literal notranslate"><span class="pre">CubicInterpMapForce_Low_Memory</span></code></a>.</p>
<p>Converts a map of (i,j,k) data and a (x,y,z)-&gt;(i,j,k) transformation
matrix to a potential energy field, with trilinear interpolation of values.</p>
<dl class="method">
<dt id="chimerax.isolde.openmm.custom_forces.LinearInterpMapForce.__init__">
<code class="sig-name descname">__init__</code><span class="sig-paren">(</span><em class="sig-param">data</em>, <em class="sig-param">xyz_to_ijk_transform</em>, <em class="sig-param">suffix</em>, <em class="sig-param">units='angstroms'</em><span class="sig-paren">)</span><a class="headerlink" href="sim_management.html#chimerax.isolde.openmm.custom_forces.LinearInterpMapForce.__init__" title="Permalink to this definition">¶</a></dt>
<dd><p>For a given atom at (x,y,z), the map potential will be defined
as:</p>
<div class="math">
<p><img src="../_images/math/278613779a559d41cc08ce57d18d70941055ea50.png" alt="global_k * individual_k * pot_xyz"/></p>
</div><p>where <cite>pot_xyz</cite> is calculated by linear interpolation from the
(i,j,k) map grid after applying <cite>xyz_to_ijk_transform</cite>.</p>
<dl class="simple">
<dt>Args:</dt><dd><ul class="simple">
<li><dl class="simple">
<dt>data:</dt><dd><ul>
<li><p>The map data as a 3D (i,j,k) NumPy array in C-style order</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>xyz_to_ijk_transform:</dt><dd><ul>
<li><p>A NumPy 3x4 float array defining the transformation matrix
mapping (x,y,z) coordinates to (i,j,k)</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>suffix:</dt><dd><ul>
<li><p>In OpenMM, global parameters are global to the <em>entire
context</em>, not just to the force. To provide a global
parameter unique to this instance, the suffix is appended
to the base name of the parameter. Should be a unique string.</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>units:</dt><dd><ul>
<li><p>The units in which the transformation matrix is defined.
Either ‘angstroms’ or ‘nanometers’</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</dd>
</dl>
</dd></dl>

</dd></dl>

</div></blockquote>
</div>
<div class="section" id="distance-restraints">
<h3><a class="toc-backref" href="sim_management.html#id10">Distance Restraints</a><a class="headerlink" href="sim_management.html#distance-restraints" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><dl class="class">
<dt id="chimerax.isolde.openmm.custom_forces.AdaptiveDistanceRestraintForce">
<em class="property">class </em><code class="sig-prename descclassname">chimerax.isolde.openmm.custom_forces.</code><code class="sig-name descname">AdaptiveDistanceRestraintForce</code><a class="headerlink" href="sim_management.html#chimerax.isolde.openmm.custom_forces.AdaptiveDistanceRestraintForce" title="Permalink to this definition">¶</a></dt>
<dd><p>A <code class="xref py py-class docutils literal notranslate"><span class="pre">openmm.CustomBondForce</span></code> subclass using the generalised adaptive
loss function described by Jonathan Barron
(<a class="reference external" href="https://arxiv.org/pdf/1701.03077.pdf">https://arxiv.org/pdf/1701.03077.pdf</a>).</p>
<p>There are many situations in which collections of distance restraints may
be approximate, or may contain some subset of restraints that are simply
incorrect. A simple example is a distance restraint network created based on
a reference model of your protein (e.g. a non-crystallographic symmetry copy
or an independent experimental model of the same protein or close
homologue). In this case the majority of restraints are likely to be
correct, but any bulk conformational change between reference model and
target will lead to some subset being wildly incorrect. In such cases it is
advantageous to use an energy function which flattens out (that is, yields
low-to-zero net force) not only at the target distance, but also once the
distance deviates sufficiently from the target. In other words, restraints
that are close to satisfied will be enforced, but restraints that are
incompatible with the data will gracefully release.</p>
<p>Various loss functions meeting these criteria have been proposed and used in
the past, each with its own specific characteristics. The function applied
here is a generalisation of the Cauchy/Lorentzian, Geman-McClure,
Welsch/Leclerc, generalised Charbonnier, Charbonnier/pseudo-Huber/L1-L2 and
L2 loss functions, using a single “robustness” parameter to tune the rate of
fall-off of restraint force with distance. This has been further adapted to
optionally allow for an arbitrary amount of “lee-way” - that is, a range in
which no bias is applied - either side of the target distance. The complete
functional form is:</p>
<div class="math">
<p><img src="../_images/math/5bd24ab695ebf40dbe2bdf8006daecbce7fcddc1.png" alt="E = \kappa *
\begin{cases}
    0, &amp; \text{if}\ enabled &lt; 0.5 \text{ or}\ |r-r_0| &lt; \tau \\
    1/2 (\frac{r-\rho}{c})^2, &amp; \text{if}\ \alpha = 2 \\
    ln(\frac{1}{2} (\frac{r-\rho}{c})^2 + 1), &amp; \text{if}\ \alpha = 0 \\
    \frac{|2-\alpha|}{\alpha} ((\frac{ (\frac{r-\rho}{c})^2 }{|2-\alpha|} + 1)^\frac{\alpha}{2} - 1), &amp; \text{otherwise}
\end{cases}"/></p>
</div><p>where</p>
<div class="math">
<p><img src="../_images/math/2bff2618a397c1301e6f2d251185a8251859bdca.png" alt="\rho =
\begin{cases}
    r-\tau, &amp; \text{if}\ (r-r_0) &lt; -\tau \\
    r+\tau, &amp; \text{if}\ (r-r_0) &gt; \tau
\end{cases}"/></p>
</div><p><code class="xref py py-attr docutils literal notranslate"><span class="pre">c</span></code> sets the width of the energy well and the distance at which the
function switches from quadratic.</p>
<p><img class="math" src="../_images/math/261e3eb56c1757dd003745ee4cc53aa595565af1.png" alt="\kappa"/> adjusts the depth of the well (that is, the absolute
magnitude of the applied force). Within the central “well” of the function,
<img class="math" src="../_images/math/f1fea5a8148e34282a568ad2f51b5632659c4be0.png" alt="\frac{\kappa}{c^2}"/> is equivalent to the spring constant in a
standard harmonic restraint.</p>
<p><img class="math" src="../_images/math/914b2d4b6659b86d3153d5510839dfb254dfc8a3.png" alt="\tau"/> sets the tolerance around the target distance. If
<img class="math" src="../_images/math/87163fb864741cc791034e1e4082a3c0d87f8e69.png" alt="|r-r_0| &lt; \tau"/> no restraining force will be applied.</p>
<p><img class="math" src="../_images/math/2f5aa019312e1bbc969deab8dca8b00f76025404.png" alt="\alpha"/> is the master parameter setting the “robustness” of the
restraint. For all values of <img class="math" src="../_images/math/2f5aa019312e1bbc969deab8dca8b00f76025404.png" alt="\alpha"/>, the shape of the function within
the range <img class="math" src="../_images/math/adbf6c25639eed23884fe5a1fdc242ae30a49190.png" alt="-c &lt; r-\rho &lt; c"/> is essentially parabolic. Outside of this
region, increasing positive values increase the steepness of the “walls”
of the restraint (NOTE: since this force does not currently obey the
<code class="xref py py-attr docutils literal notranslate"><span class="pre">max_force</span></code> imposed on ISOLDE’s other custom forces, use this with
care to avoid instability). Values larger than 2 are inadvisable. A value
of <img class="math" src="../_images/math/49f47a876df8f306180277ff068d12e4b6067ae6.png" alt="\alpha = 2"/> yields a standard harmonic (quadratic) restraint.
When <img class="math" src="../_images/math/fadb91aa702252a3535e8d9e62e2651411725d3b.png" alt="\alpha = 1"/>, the restraining force transitions from harmonic to
essentially constant (i.e. linear) between <img class="math" src="../_images/math/1c1396975936f8348ffcd3dfb0ffb56e3220f8dd.png" alt="c &lt; |r-\rho| &lt; 2c"/>. When
<img class="math" src="../_images/math/4cfc6181312f8d6d284d22109b3e663a7104af7f.png" alt="\alpha = 0"/>, the force at large distances is proportional to
<img class="math" src="../_images/math/da26aa4d827de9fcf43ce36e4aac9df13165fbb8.png" alt="\frac{1}{|r-\rho|}"/>. For increasing negative values of <img class="math" src="../_images/math/2f5aa019312e1bbc969deab8dca8b00f76025404.png" alt="\alpha"/>
the applied force falls off faster with distance. When <img class="math" src="../_images/math/a7118b9f997c3c2ccc781351231974d27d2bcc78.png" alt="\alpha = -2"/>,
the force falls to 10% of the maximum at approx. <img class="math" src="../_images/math/971f499f838fe315a649642cf41cd6f667111016.png" alt="|r-\rho| = 7c"/>; when
<img class="math" src="../_images/math/a14653eddc693118f5a7a32fdc055195629a4035.png" alt="\alpha = -10"/> the force at this point is approx. 0.1% of maximum. For
very large negative values of <img class="math" src="../_images/math/f0d949c29370cd898ed70f8f32a09349764a1ebb.png" alt="alpha"/> (beyond about -50) the
function converges to a form where the applied force is negligible for
<img class="math" src="../_images/math/87a47dcbc4017d6228bd0c7fa22a473d3303c485.png" alt="|r-rho| &gt; 6c"/>.</p>
<p>All parameters are settable at the individual restraint level.</p>
<dl class="method">
<dt id="chimerax.isolde.openmm.custom_forces.AdaptiveDistanceRestraintForce.__init__">
<code class="sig-name descname">__init__</code><span class="sig-paren">(</span><em class="sig-param">self</em>, <em class="sig-param">energy</em><span class="sig-paren">)</span> &#x2192; CustomBondForce<a class="headerlink" href="sim_management.html#chimerax.isolde.openmm.custom_forces.AdaptiveDistanceRestraintForce.__init__" title="Permalink to this definition">¶</a></dt>
<dd><p>__init__(self, other) -&gt; CustomBondForce</p>
<p>Create a CustomBondForce.</p>
<dl class="simple">
<dt>energy<span class="classifier">string</span></dt><dd><p>an algebraic expression giving the interaction energy between two bonded particles as a function of r, the distance between them</p>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="chimerax.isolde.openmm.custom_forces.AdaptiveDistanceRestraintForce.add_bonds">
<code class="sig-name descname">add_bonds</code><span class="sig-paren">(</span><em class="sig-param">atom_indices</em>, <em class="sig-param">enableds</em>, <em class="sig-param">kappas</em>, <em class="sig-param">cs</em>, <em class="sig-param">targets</em>, <em class="sig-param">tolerances</em>, <em class="sig-param">alphas</em><span class="sig-paren">)</span><a class="headerlink" href="sim_management.html#chimerax.isolde.openmm.custom_forces.AdaptiveDistanceRestraintForce.add_bonds" title="Permalink to this definition">¶</a></dt>
<dd><p>Add a set of bonds to the simulation, using a fast C++ function. Fastest
if all parameters are supplied as NumPy arrays.</p>
<p>Args:</p>
<blockquote>
<div><ul class="simple">
<li><dl class="simple">
<dt>atom_indices:</dt><dd><ul>
<li><p>a 2-tuple of integer arrays giving the indices of the bonded
atoms in the simulation construct</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>enableds:</dt><dd><ul>
<li><p>a Boolean array defining which restraints are to be active</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>kappas:</dt><dd><ul>
<li><p>a float array of energy scaling constants in
<img class="math" src="../_images/math/28d43a92ec129096071ab757420970a2cdf011c5.png" alt="kJ mol^{-1}"/>. For a given restraint,
<img class="math" src="../_images/math/f1fea5a8148e34282a568ad2f51b5632659c4be0.png" alt="\frac{\kappa}{c^2}"/> is equivalent to a harmonic spring
constant when the distance is close to the target.</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>cs:</dt><dd><ul>
<li><p>a float array setting the “width” of the energy well for each
restraint in nanometres. A restraint behaves like a normal
harmonic restraint when the current distance is less than
<code class="xref py py-attr docutils literal notranslate"><span class="pre">c</span></code> from the target distance.</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>targets:</dt><dd><ul>
<li><p>a float array of target distances in nanometres</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>tolerances:</dt><dd><ul>
<li><p>a float array in nanometres. When <img class="math" src="../_images/math/5a6e147c284dd65c08a777715d27429cf33d1ce1.png" alt="|r-r_0|"/> is less than
the tolerance, no force will be applied.</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>alphas:</dt><dd><ul>
<li><p>a float array of terms setting the “steepness” of each
restraint outside of the central well. Values less than one
cause the applied force to fall off with increasing distance.</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</div></blockquote>
</dd></dl>

<dl class="method">
<dt id="chimerax.isolde.openmm.custom_forces.AdaptiveDistanceRestraintForce.update_target">
<code class="sig-name descname">update_target</code><span class="sig-paren">(</span><em class="sig-param">index</em>, <em class="sig-param">enabled=None</em>, <em class="sig-param">kappa=None</em>, <em class="sig-param">c=None</em>, <em class="sig-param">target=None</em>, <em class="sig-param">tolerance=None</em>, <em class="sig-param">alpha=None</em><span class="sig-paren">)</span><a class="headerlink" href="sim_management.html#chimerax.isolde.openmm.custom_forces.AdaptiveDistanceRestraintForce.update_target" title="Permalink to this definition">¶</a></dt>
<dd><p>Update the parameters for an existing restraint in the simulation.
Mostly superseded by <a class="reference internal" href="sim_management.html#chimerax.isolde.openmm.custom_forces.AdaptiveDistanceRestraintForce.update_targets" title="chimerax.isolde.openmm.custom_forces.AdaptiveDistanceRestraintForce.update_targets"><code class="xref py py-func docutils literal notranslate"><span class="pre">update_targets()</span></code></a>.</p>
<p>Args:</p>
<blockquote>
<div><ul class="simple">
<li><dl class="simple">
<dt>index:</dt><dd><ul>
<li><p>the index of this restraint in the OpenMM force object</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>enabled:</dt><dd><ul>
<li><p>Boolean flag defining whether the restraint is to be enabled.
None = keep current value.</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>kappa:</dt><dd><ul>
<li><p>Energy scaling constant (as a <code class="xref py py-class docutils literal notranslate"><span class="pre">simtk.Quantity</span></code> or in
units of <img class="math" src="../_images/math/28d43a92ec129096071ab757420970a2cdf011c5.png" alt="kJ mol^{-1}"/>). When the distance is close to
the target, <img class="math" src="../_images/math/f1fea5a8148e34282a568ad2f51b5632659c4be0.png" alt="\frac{\kappa}{c^2}"/> is equivalent to a
harmonic spring constant. None = keep current value.</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>c:</dt><dd><ul>
<li><p>A distance (in nanometres) defining the width of the central
“well” of the energy function. None = keep current value.</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>target:</dt><dd><ul>
<li><p>the new target distance (as a <code class="xref py py-class docutils literal notranslate"><span class="pre">simtk.Quantity</span></code> or in
nanometres). None = keep current value.</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>tolerance:</dt><dd><ul>
<li><p>Distance (in nanometres) around the target distance below
which no biasing force will be applied. None = keep current
value.</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>alpha:</dt><dd><ul>
<li><p>Dimensionless value dictating how quickly the energy grows or
levels out for large deviations from the target distance.
Values less than one cause the applied force to fall off with
increasing distance. None = keep current value.</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</div></blockquote>
</dd></dl>

<dl class="method">
<dt id="chimerax.isolde.openmm.custom_forces.AdaptiveDistanceRestraintForce.update_targets">
<code class="sig-name descname">update_targets</code><span class="sig-paren">(</span><em class="sig-param">indices</em>, <em class="sig-param">enableds</em>, <em class="sig-param">kappas</em>, <em class="sig-param">cs</em>, <em class="sig-param">targets</em>, <em class="sig-param">tolerances</em>, <em class="sig-param">alphas</em><span class="sig-paren">)</span><a class="headerlink" href="sim_management.html#chimerax.isolde.openmm.custom_forces.AdaptiveDistanceRestraintForce.update_targets" title="Permalink to this definition">¶</a></dt>
<dd><p>Update a set of targets all at once using fast C++ code. Fastest if
the arguments are provided as Numpy arrays, but any iterable will work.</p>
<p>Args:</p>
<blockquote>
<div><ul class="simple">
<li><dl class="simple">
<dt>indices:</dt><dd><ul>
<li><p>the indices of the restraints in the OpenMM force object</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>enableds:</dt><dd><ul>
<li><p>a Boolean array defining which restraints are to be active</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>kappas:</dt><dd><ul>
<li><p>a float array of energy scaling constants in
<img class="math" src="../_images/math/28d43a92ec129096071ab757420970a2cdf011c5.png" alt="kJ mol^{-1}"/>. For a given restraint,
<img class="math" src="../_images/math/f1fea5a8148e34282a568ad2f51b5632659c4be0.png" alt="\frac{\kappa}{c^2}"/> is equivalent to a harmonic spring
constant when the distance is close to the target.</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>cs:</dt><dd><ul>
<li><p>a float array setting the “width” of the energy well for each
restraint in nanometres. A restraint behaves like a normal
harmonic restraint when the current distance is less than
<code class="xref py py-attr docutils literal notranslate"><span class="pre">c</span></code> from the target distance.</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>targets:</dt><dd><ul>
<li><p>a float array of target distances in nanometres</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>tolerances:</dt><dd><ul>
<li><p>a float array in nanometres. When <img class="math" src="../_images/math/5a6e147c284dd65c08a777715d27429cf33d1ce1.png" alt="|r-r_0|"/> is less than
the tolerance, no force will be applied.</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>alphas:</dt><dd><ul>
<li><p>a float array of terms setting the “steepness” of each
restraint outside of the central well. Values less than one
cause the applied force to fall off with increasing distance.</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</div></blockquote>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="chimerax.isolde.openmm.custom_forces.TopOutBondForce">
<em class="property">class </em><code class="sig-prename descclassname">chimerax.isolde.openmm.custom_forces.</code><code class="sig-name descname">TopOutBondForce</code><span class="sig-paren">(</span><em class="sig-param">max_force</em><span class="sig-paren">)</span><a class="headerlink" href="sim_management.html#chimerax.isolde.openmm.custom_forces.TopOutBondForce" title="Permalink to this definition">¶</a></dt>
<dd><p>A <code class="xref py py-class docutils literal notranslate"><span class="pre">openmm.CustomBondForce</span></code> subclass defined as a standard harmonic
potential with a user-defined fixed maximum cutoff on the applied force. Any
restraint can be switched on (off) by setting the ‘enabled’ parameter to 1
(0). This is designed for steering the simulation into new conformations
where the starting distance may be far from the target bond length, leading
to catastrophically large forces with a standard harmonic potential. The
effective energy equation is:</p>
<div class="math">
<p><img src="../_images/math/7cc50b411d18efa5652ecdefd6c2fab74d172952.png" alt="E =
\begin{cases}
    0, &amp; \text{if}\ enabled &lt; 0.5 \\
    \text{max\_force} * abs(r-r_0), &amp; \text{if}\ (r-r_0) - \text{max\_force}/k &gt; 0 \\
    0.5 * k * (r - r_0)^2, &amp; \text{otherwise}
\end{cases}"/></p>
</div><dl class="method">
<dt id="chimerax.isolde.openmm.custom_forces.TopOutBondForce.__init__">
<code class="sig-name descname">__init__</code><span class="sig-paren">(</span><em class="sig-param">max_force</em><span class="sig-paren">)</span><a class="headerlink" href="sim_management.html#chimerax.isolde.openmm.custom_forces.TopOutBondForce.__init__" title="Permalink to this definition">¶</a></dt>
<dd><p>Initialise the force object and set the maximum force magnitude.</p>
<dl class="simple">
<dt>Args:</dt><dd><ul class="simple">
<li><dl class="simple">
<dt>max_force:</dt><dd><ul>
<li><p>maximum allowable force in <img class="math" src="../_images/math/1d35199d4a4f464e55ae5e1d8f1059180b0eba40.png" alt="kJ mol^{-1} nm^{-1}"/></p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="chimerax.isolde.openmm.custom_forces.TopOutBondForce.add_bonds">
<code class="sig-name descname">add_bonds</code><span class="sig-paren">(</span><em class="sig-param">atom_indices</em>, <em class="sig-param">enableds</em>, <em class="sig-param">spring_constants</em>, <em class="sig-param">targets</em><span class="sig-paren">)</span><a class="headerlink" href="sim_management.html#chimerax.isolde.openmm.custom_forces.TopOutBondForce.add_bonds" title="Permalink to this definition">¶</a></dt>
<dd><p>Add a set of bonds to the simulation, using a fast C++ function. Fastest
if all parameters are supplied as NumPy arrays.</p>
<dl class="simple">
<dt>Args:</dt><dd><ul class="simple">
<li><dl class="simple">
<dt>atom_indices:</dt><dd><ul>
<li><p>a 2-tuple of integer arrays giving the indices of the bonded
atoms in the simulation construct</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>enableds:</dt><dd><ul>
<li><p>a Boolean array defining which restraints are to be active</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>spring_constants:</dt><dd><ul>
<li><p>a float array of spring constants in <img class="math" src="../_images/math/18d4f7064f2d08134d9a12d2fb4b74b1e3a71446.png" alt="kJ mol^{-1} nm^{-2}"/></p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>targets:</dt><dd><ul>
<li><p>a float array of target distances in nanometers</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="chimerax.isolde.openmm.custom_forces.TopOutBondForce.max_force">
<em class="property">property </em><code class="sig-name descname">max_force</code><a class="headerlink" href="sim_management.html#chimerax.isolde.openmm.custom_forces.TopOutBondForce.max_force" title="Permalink to this definition">¶</a></dt>
<dd><p>Get/set the maximum force to be applied to any given atom, in
<img class="math" src="../_images/math/1d35199d4a4f464e55ae5e1d8f1059180b0eba40.png" alt="kJ mol^{-1} nm^{-1}"/></p>
</dd></dl>

<dl class="method">
<dt id="chimerax.isolde.openmm.custom_forces.TopOutBondForce.update_target">
<code class="sig-name descname">update_target</code><span class="sig-paren">(</span><em class="sig-param">index</em>, <em class="sig-param">enabled=None</em>, <em class="sig-param">k=None</em>, <em class="sig-param">target=None</em><span class="sig-paren">)</span><a class="headerlink" href="sim_management.html#chimerax.isolde.openmm.custom_forces.TopOutBondForce.update_target" title="Permalink to this definition">¶</a></dt>
<dd><p>Update the parameters for an existing restraint in the simulation.
Mostly superseded by <a class="reference internal" href="sim_management.html#chimerax.isolde.openmm.custom_forces.TopOutBondForce.update_targets" title="chimerax.isolde.openmm.custom_forces.TopOutBondForce.update_targets"><code class="xref py py-func docutils literal notranslate"><span class="pre">update_targets()</span></code></a>.</p>
<dl class="simple">
<dt>Args:</dt><dd><ul class="simple">
<li><dl class="simple">
<dt>index:</dt><dd><ul>
<li><p>the index of this restraint in the OpenMM force object</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>enabled:</dt><dd><ul>
<li><p>Boolean flag defining whether the restraint is to be enabled.
None = keep current value.</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>k:</dt><dd><ul>
<li><p>The new spring constant (as a <code class="xref py py-class docutils literal notranslate"><span class="pre">simtk.Quantity</span></code> or in
units of <img class="math" src="../_images/math/18d4f7064f2d08134d9a12d2fb4b74b1e3a71446.png" alt="kJ mol^{-1} nm^{-2}"/>). None = keep current
value.</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>target:</dt><dd><ul>
<li><p>the new target distance (as a <code class="xref py py-class docutils literal notranslate"><span class="pre">simtk.Quantity</span></code> or in
nanometres). None = keep current value.</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="chimerax.isolde.openmm.custom_forces.TopOutBondForce.update_targets">
<code class="sig-name descname">update_targets</code><span class="sig-paren">(</span><em class="sig-param">indices</em>, <em class="sig-param">enableds</em>, <em class="sig-param">spring_constants</em>, <em class="sig-param">targets</em><span class="sig-paren">)</span><a class="headerlink" href="sim_management.html#chimerax.isolde.openmm.custom_forces.TopOutBondForce.update_targets" title="Permalink to this definition">¶</a></dt>
<dd><p>Update a set of targets all at once using fast C++ code. Fastest if
the arguments are provided as Numpy arrays, but any iterable will work.</p>
<dl class="simple">
<dt>Args:</dt><dd><ul class="simple">
<li><dl class="simple">
<dt>indices:</dt><dd><ul>
<li><p>the indices of the restraints in the OpenMM force object</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>enableds:</dt><dd><ul>
<li><p>a Boolean array defining which restraints are to be enabled</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>spring_constants:</dt><dd><ul>
<li><p>The new spring constants in units of <img class="math" src="../_images/math/18d4f7064f2d08134d9a12d2fb4b74b1e3a71446.png" alt="kJ mol^{-1} nm^{-2}"/></p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>targets:</dt><dd><ul>
<li><p>the new target distances in nanometres</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</dd>
</dl>
</dd></dl>

</dd></dl>

</div></blockquote>
</div>
<div class="section" id="position-restraints">
<h3><a class="toc-backref" href="sim_management.html#id11">Position Restraints</a><a class="headerlink" href="sim_management.html#position-restraints" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><dl class="class">
<dt id="chimerax.isolde.openmm.custom_forces.TopOutRestraintForce">
<em class="property">class </em><code class="sig-prename descclassname">chimerax.isolde.openmm.custom_forces.</code><code class="sig-name descname">TopOutRestraintForce</code><span class="sig-paren">(</span><em class="sig-param">max_force</em><span class="sig-paren">)</span><a class="headerlink" href="sim_management.html#chimerax.isolde.openmm.custom_forces.TopOutRestraintForce" title="Permalink to this definition">¶</a></dt>
<dd><p>A <code class="xref py py-class docutils literal notranslate"><span class="pre">openmm.CustomExternalForce</span></code> subclass designed to restrain atoms
to defined positions via a standard harmonic potential with a user-defined
fixed maximum cutoff on the applied force. Used for position restraints as
well as for imposing interactive tugging forces, this is designed for
steering the simulation into new conformations where the starting positions
may be far from the target positions, leading to catastrophically large
forces with a standard harmonic potential. The effective energy equation is:</p>
<div class="math">
<p><img src="../_images/math/a23b5a3488bb93d85896b97e59d11f8e5d56ae54.png" alt="E =
\begin{cases}
    0, &amp; \text{if}\ enabled &lt; 0.5 \\
    \text{max\_force} * r, &amp; \text{if}\ r - \text{max\_force}/k &gt; 0 \\
    0.5 * k * r^2, &amp; \text{otherwise}
\end{cases}"/></p>
</div><dl class="method">
<dt id="chimerax.isolde.openmm.custom_forces.TopOutRestraintForce.__init__">
<code class="sig-name descname">__init__</code><span class="sig-paren">(</span><em class="sig-param">max_force</em><span class="sig-paren">)</span><a class="headerlink" href="sim_management.html#chimerax.isolde.openmm.custom_forces.TopOutRestraintForce.__init__" title="Permalink to this definition">¶</a></dt>
<dd><p>Initialise the force object and set the maximum force magnitude.</p>
<dl class="simple">
<dt>Args:</dt><dd><ul class="simple">
<li><dl class="simple">
<dt>max_force:</dt><dd><ul>
<li><p>maximum allowable force in <img class="math" src="../_images/math/1d35199d4a4f464e55ae5e1d8f1059180b0eba40.png" alt="kJ mol^{-1} nm^{-1}"/></p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="chimerax.isolde.openmm.custom_forces.TopOutRestraintForce.add_particles">
<code class="sig-name descname">add_particles</code><span class="sig-paren">(</span><em class="sig-param">indices</em>, <em class="sig-param">enableds</em>, <em class="sig-param">spring_constants</em>, <em class="sig-param">targets</em><span class="sig-paren">)</span><a class="headerlink" href="sim_management.html#chimerax.isolde.openmm.custom_forces.TopOutRestraintForce.add_particles" title="Permalink to this definition">¶</a></dt>
<dd><p>Add a set of restraints to the simulation, using a fast C++ function.
Fastest if all parameters are supplied as NumPy arrays.</p>
<dl class="simple">
<dt>Args:</dt><dd><ul class="simple">
<li><dl class="simple">
<dt>atom_indices:</dt><dd><ul>
<li><p>integer array giving the indices of the restrained atoms in
the simulation construct</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>enableds:</dt><dd><ul>
<li><p>a Boolean array defining which restraints are to be active</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>spring_constants:</dt><dd><ul>
<li><p>a float array of spring constants in <img class="math" src="../_images/math/18d4f7064f2d08134d9a12d2fb4b74b1e3a71446.png" alt="kJ mol^{-1} nm^{-2}"/></p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>targets:</dt><dd><ul>
<li><p>a (nx3) float array of (x,y,z) target positions in nanometres</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="chimerax.isolde.openmm.custom_forces.TopOutRestraintForce.max_force">
<em class="property">property </em><code class="sig-name descname">max_force</code><a class="headerlink" href="sim_management.html#chimerax.isolde.openmm.custom_forces.TopOutRestraintForce.max_force" title="Permalink to this definition">¶</a></dt>
<dd><p>Get/set the maximum force applied to any given atom, in
<img class="math" src="../_images/math/1d35199d4a4f464e55ae5e1d8f1059180b0eba40.png" alt="kJ mol^{-1} nm^{-1}"/>.</p>
</dd></dl>

<dl class="method">
<dt id="chimerax.isolde.openmm.custom_forces.TopOutRestraintForce.release_restraint">
<code class="sig-name descname">release_restraint</code><span class="sig-paren">(</span><em class="sig-param">index</em><span class="sig-paren">)</span><a class="headerlink" href="sim_management.html#chimerax.isolde.openmm.custom_forces.TopOutRestraintForce.release_restraint" title="Permalink to this definition">¶</a></dt>
<dd><p>Disable a single restraint.</p>
<dl class="simple">
<dt>Args:</dt><dd><ul class="simple">
<li><dl class="simple">
<dt>index:</dt><dd><ul>
<li><p>the index of the restraint to be disabled.</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="chimerax.isolde.openmm.custom_forces.TopOutRestraintForce.update_target">
<code class="sig-name descname">update_target</code><span class="sig-paren">(</span><em class="sig-param">index</em>, <em class="sig-param">enabled=None</em>, <em class="sig-param">k=None</em>, <em class="sig-param">target=None</em><span class="sig-paren">)</span><a class="headerlink" href="sim_management.html#chimerax.isolde.openmm.custom_forces.TopOutRestraintForce.update_target" title="Permalink to this definition">¶</a></dt>
<dd><p>Update a single restraint. This function is mostly superseded by
<a class="reference internal" href="sim_management.html#chimerax.isolde.openmm.custom_forces.TopOutRestraintForce.update_targets" title="chimerax.isolde.openmm.custom_forces.TopOutRestraintForce.update_targets"><code class="xref py py-func docutils literal notranslate"><span class="pre">update_targets()</span></code></a>.</p>
<dl class="simple">
<dt>Args:</dt><dd><ul class="simple">
<li><dl class="simple">
<dt>index:</dt><dd><ul>
<li><p>integer index of the restraint in the force object</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>enabled:</dt><dd><ul>
<li><p>enable/disable the restraint. None keeps the current value.</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>k:</dt><dd><ul>
<li><p>set the spring constant in <img class="math" src="../_images/math/18d4f7064f2d08134d9a12d2fb4b74b1e3a71446.png" alt="kJ mol^{-1} nm^{-2}"/>.
None keeps the current value.</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>target:</dt><dd><ul>
<li><p>set the target (x,y,z) position in nanometres. None keeps
the current value.</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="chimerax.isolde.openmm.custom_forces.TopOutRestraintForce.update_targets">
<code class="sig-name descname">update_targets</code><span class="sig-paren">(</span><em class="sig-param">indices</em>, <em class="sig-param">enableds</em>, <em class="sig-param">spring_constants</em>, <em class="sig-param">targets</em><span class="sig-paren">)</span><a class="headerlink" href="sim_management.html#chimerax.isolde.openmm.custom_forces.TopOutRestraintForce.update_targets" title="Permalink to this definition">¶</a></dt>
<dd><p>Update a set of targets all at once using fast C++ code. Fastest if
the arguments are provided as Numpy arrays, but any iterable should work.</p>
<dl class="simple">
<dt>Args:</dt><dd><ul class="simple">
<li><dl class="simple">
<dt>indices:</dt><dd><ul>
<li><p>the indices of the restraints in the OpenMM force object</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>enableds:</dt><dd><ul>
<li><p>a Boolean array defining which restraints are to be enabled</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>spring_constants:</dt><dd><ul>
<li><p>The new spring constants in units of <img class="math" src="../_images/math/18d4f7064f2d08134d9a12d2fb4b74b1e3a71446.png" alt="kJ mol^{-1} nm^{-2}"/></p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>targets:</dt><dd><ul>
<li><p>A (nx3) float array providing the new target (x,y,z) positions
in nanometres.</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</dd>
</dl>
</dd></dl>

</dd></dl>

</div></blockquote>
</div>
<div class="section" id="dihedral-restraints">
<h3><a class="toc-backref" href="sim_management.html#id12">Dihedral Restraints</a><a class="headerlink" href="sim_management.html#dihedral-restraints" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><dl class="class">
<dt id="chimerax.isolde.openmm.custom_forces.FlatBottomTorsionRestraintForce">
<em class="property">class </em><code class="sig-prename descclassname">chimerax.isolde.openmm.custom_forces.</code><code class="sig-name descname">FlatBottomTorsionRestraintForce</code><a class="headerlink" href="sim_management.html#chimerax.isolde.openmm.custom_forces.FlatBottomTorsionRestraintForce" title="Permalink to this definition">¶</a></dt>
<dd><p>A <code class="xref py py-class docutils literal notranslate"><span class="pre">openmm.CustomTorsionForce</span></code> subclass designed to restrain
torsion angles while allowing free movement within a range (target +/-
cutoff). Within the cutoff range the potential is constant (that is, zero
force is applied).
The effective energy function is:</p>
<div class="math">
<p><img src="../_images/math/6dbbeb42fb6c2fcd65ba1aeab9ae04df72113cbf.png" alt="E =
\begin{cases}
    0, &amp; \text{if}\ enabled &lt; 0.5 \\
    -k*cos(\theta_\text{cutoff}), &amp; \text{if}\ cos(\theta-\theta_0) - cos(\theta_\text{cutoff}) &lt; 0 \\
    -k*cos(\theta-\theta_0), &amp; \text{otherwise}
\end{cases}"/></p>
</div><dl class="method">
<dt id="chimerax.isolde.openmm.custom_forces.FlatBottomTorsionRestraintForce.__init__">
<code class="sig-name descname">__init__</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="sim_management.html#chimerax.isolde.openmm.custom_forces.FlatBottomTorsionRestraintForce.__init__" title="Permalink to this definition">¶</a></dt>
<dd><p>Initialise the force object. No restraints are added at this stage.</p>
</dd></dl>

<dl class="method">
<dt id="chimerax.isolde.openmm.custom_forces.FlatBottomTorsionRestraintForce.add_torsions">
<code class="sig-name descname">add_torsions</code><span class="sig-paren">(</span><em class="sig-param">atom_indices</em>, <em class="sig-param">enableds</em>, <em class="sig-param">spring_constants</em>, <em class="sig-param">targets</em>, <em class="sig-param">cutoffs</em><span class="sig-paren">)</span><a class="headerlink" href="sim_management.html#chimerax.isolde.openmm.custom_forces.FlatBottomTorsionRestraintForce.add_torsions" title="Permalink to this definition">¶</a></dt>
<dd><p>Add a set of torsion restraints using a fast C++ function. Returns a
NumPy integer array giving the indices of the restraints in the force
object. Fastest if the inputs are NumPy arrays, but most iterables
should work.</p>
<dl class="simple">
<dt>Args:</dt><dd><ul class="simple">
<li><dl class="simple">
<dt>atom_indices:</dt><dd><ul>
<li><p>A 4-tuple of arrays providing the indices of the dihedral
atoms in the simulation construct</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>enableds:</dt><dd><ul>
<li><p>A Boolean array (or any array castable to float) where values
&gt; 0.5 represent enabled restraints</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>spring_constants:</dt><dd><ul>
<li><p>Restraint spring constants in <img class="math" src="../_images/math/ff27382e6aebfca4940536667df9d011dbc5ad85.png" alt="kJ mol^{-1} rad^{-2}"/></p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>targets:</dt><dd><ul>
<li><p>Target angles in radians</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>cutoffs:</dt><dd><ul>
<li><p>Cutoff angle (below which no force is applied) for each
restraint in radians.</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="chimerax.isolde.openmm.custom_forces.FlatBottomTorsionRestraintForce.update_target">
<code class="sig-name descname">update_target</code><span class="sig-paren">(</span><em class="sig-param">index</em>, <em class="sig-param">enabled=None</em>, <em class="sig-param">k=None</em>, <em class="sig-param">target=None</em>, <em class="sig-param">cutoff=None</em><span class="sig-paren">)</span><a class="headerlink" href="sim_management.html#chimerax.isolde.openmm.custom_forces.FlatBottomTorsionRestraintForce.update_target" title="Permalink to this definition">¶</a></dt>
<dd><p>Update a single restraint. This function is mostly superseded by
<a class="reference internal" href="sim_management.html#chimerax.isolde.openmm.custom_forces.FlatBottomTorsionRestraintForce.update_targets" title="chimerax.isolde.openmm.custom_forces.FlatBottomTorsionRestraintForce.update_targets"><code class="xref py py-func docutils literal notranslate"><span class="pre">update_targets()</span></code></a>.</p>
<dl class="simple">
<dt>Args:</dt><dd><ul class="simple">
<li><dl class="simple">
<dt>index:</dt><dd><ul>
<li><p>integer index of the restraint in the force object</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>enabled:</dt><dd><ul>
<li><p>enable/disable the restraint. None keeps the current value.</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>k:</dt><dd><ul>
<li><p>set the spring constant in <img class="math" src="../_images/math/ff27382e6aebfca4940536667df9d011dbc5ad85.png" alt="kJ mol^{-1} rad^{-2}"/>.
None keeps the current value.</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>target:</dt><dd><ul>
<li><p>set the target angle in radians. None keeps the current value.</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>cutoff:</dt><dd><ul>
<li><p>set the cutoff angle in radians. None keeps the current value.</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="chimerax.isolde.openmm.custom_forces.FlatBottomTorsionRestraintForce.update_targets">
<code class="sig-name descname">update_targets</code><span class="sig-paren">(</span><em class="sig-param">indices</em>, <em class="sig-param">enableds</em>, <em class="sig-param">spring_constants</em>, <em class="sig-param">targets</em>, <em class="sig-param">cutoffs</em><span class="sig-paren">)</span><a class="headerlink" href="sim_management.html#chimerax.isolde.openmm.custom_forces.FlatBottomTorsionRestraintForce.update_targets" title="Permalink to this definition">¶</a></dt>
<dd><p>Update a set of targets all at once using fast C++ code. Fastest if
the arguments are provided as NumPy arrays, but any iterable should work.</p>
<dl class="simple">
<dt>Args:</dt><dd><ul class="simple">
<li><dl class="simple">
<dt>indices:</dt><dd><ul>
<li><p>the indices of the restraints in the OpenMM force object</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>enableds:</dt><dd><ul>
<li><p>a Boolean array defining which restraints are to be enabled</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>spring_constants:</dt><dd><ul>
<li><p>the new spring constants in units of <img class="math" src="../_images/math/ff27382e6aebfca4940536667df9d011dbc5ad85.png" alt="kJ mol^{-1} rad^{-2}"/></p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>targets:</dt><dd><ul>
<li><p>the new target angles in radians</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>cutoffs:</dt><dd><ul>
<li><p>the new cutoff angles in radians</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</dd>
</dl>
</dd></dl>

</dd></dl>

</div></blockquote>
</div>
<div class="section" id="cmap-correction-terms">
<h3><a class="toc-backref" href="sim_management.html#id13">CMAP Correction terms</a><a class="headerlink" href="sim_management.html#cmap-correction-terms" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><dl class="class">
<dt id="chimerax.isolde.openmm.custom_forces.AmberCMAPForce">
<em class="property">class </em><code class="sig-prename descclassname">chimerax.isolde.openmm.custom_forces.</code><code class="sig-name descname">AmberCMAPForce</code><a class="headerlink" href="sim_management.html#chimerax.isolde.openmm.custom_forces.AmberCMAPForce" title="Permalink to this definition">¶</a></dt>
<dd><p>CMAP-style corrections to AMBER 12/14 forcefields to give improved
backbone conformations in implicit solvent.
Ref: <a class="reference external" href="http://pubs.acs.org/doi/pdf/10.1021/acs.jctc.5b00662">http://pubs.acs.org/doi/pdf/10.1021/acs.jctc.5b00662</a></p>
<dl class="method">
<dt id="chimerax.isolde.openmm.custom_forces.AmberCMAPForce.__init__">
<code class="sig-name descname">__init__</code><span class="sig-paren">(</span><em class="sig-param">self</em><span class="sig-paren">)</span> &#x2192; CMAPTorsionForce<a class="headerlink" href="sim_management.html#chimerax.isolde.openmm.custom_forces.AmberCMAPForce.__init__" title="Permalink to this definition">¶</a></dt>
<dd><p>__init__(self, other) -&gt; CMAPTorsionForce</p>
<p>Create a CMAPTorsionForce.</p>
</dd></dl>

<dl class="method">
<dt id="chimerax.isolde.openmm.custom_forces.AmberCMAPForce.addTorsion">
<code class="sig-name descname">addTorsion</code><span class="sig-paren">(</span><em class="sig-param">resname</em>, <em class="sig-param">phi_indices</em>, <em class="sig-param">psi_indices</em><span class="sig-paren">)</span><a class="headerlink" href="sim_management.html#chimerax.isolde.openmm.custom_forces.AmberCMAPForce.addTorsion" title="Permalink to this definition">¶</a></dt>
<dd><p>Add a single phi/psi pair to the force.</p>
<dl class="simple">
<dt>Args:</dt><dd><ul class="simple">
<li><dl class="simple">
<dt>resname:</dt><dd><ul>
<li><p>the upper-case three-character name of the amino acid residue</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>phi_indices:</dt><dd><ul>
<li><p>a NumPy array of four ints giving the indices of the phi
dihedral atoms in the simulation</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>psi_indices:</dt><dd><ul>
<li><p>a NumPy array of four ints giving the indices of the psi
dihedral atoms in the simulation</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="chimerax.isolde.openmm.custom_forces.AmberCMAPForce.add_torsions">
<code class="sig-name descname">add_torsions</code><span class="sig-paren">(</span><em class="sig-param">resnames</em>, <em class="sig-param">phi_indices</em>, <em class="sig-param">psi_indices</em><span class="sig-paren">)</span><a class="headerlink" href="sim_management.html#chimerax.isolde.openmm.custom_forces.AmberCMAPForce.add_torsions" title="Permalink to this definition">¶</a></dt>
<dd><p>Add a set of peptide backbone (phi, psi) pairs to the force.</p>
<dl class="simple">
<dt>Args:</dt><dd><ul class="simple">
<li><dl class="simple">
<dt>resnames:</dt><dd><ul>
<li><p>an iterable of upper-case three-letter residue names</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>phi_indices:</dt><dd><ul>
<li><p>a (nx4) NumPy integer array giving the indices of the atoms
from each phi dihedral in the simulation</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>psi_indices:</dt><dd><ul>
<li><p>a (nx4) NumPy integer array giving the indices of the atoms
from each psi dihedral in the simulation</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</dd>
</dl>
</dd></dl>

</dd></dl>

</div></blockquote>
</div>
<div class="section" id="implicit-solvent">
<h3><a class="toc-backref" href="sim_management.html#id14">Implicit Solvent</a><a class="headerlink" href="sim_management.html#implicit-solvent" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><dl class="class">
<dt id="chimerax.isolde.openmm.custom_forces.GBSAForce">
<em class="property">class </em><code class="sig-prename descclassname">chimerax.isolde.openmm.custom_forces.</code><code class="sig-name descname">GBSAForce</code><span class="sig-paren">(</span><em class="sig-param">solventDielectric=78.5</em>, <em class="sig-param">soluteDielectric=1</em>, <em class="sig-param">SA='ACE'</em>, <em class="sig-param">cutoff=1.0</em>, <em class="sig-param">kappa=3.0</em>, <em class="sig-param">nonbonded_method=1</em><span class="sig-paren">)</span><a class="headerlink" href="sim_management.html#chimerax.isolde.openmm.custom_forces.GBSAForce" title="Permalink to this definition">¶</a></dt>
<dd><p>Wrapper around <code class="xref py py-class docutils literal notranslate"><span class="pre">openmm.GBSAGBn2Force</span></code> which implements the
generalised Born GB-Neck2 implicit solvent implementation.</p>
<dl class="method">
<dt id="chimerax.isolde.openmm.custom_forces.GBSAForce.__init__">
<code class="sig-name descname">__init__</code><span class="sig-paren">(</span><em class="sig-param">solventDielectric=78.5</em>, <em class="sig-param">soluteDielectric=1</em>, <em class="sig-param">SA='ACE'</em>, <em class="sig-param">cutoff=1.0</em>, <em class="sig-param">kappa=3.0</em>, <em class="sig-param">nonbonded_method=1</em><span class="sig-paren">)</span><a class="headerlink" href="sim_management.html#chimerax.isolde.openmm.custom_forces.GBSAForce.__init__" title="Permalink to this definition">¶</a></dt>
<dd><p>Initialise the force object. Defaults are chosen to represent a salt
concentration of approximately 0.5M at 100K, broadly representative of
the conditions within typical protein crystals.</p>
<dl class="simple">
<dt>Args:</dt><dd><ul class="simple">
<li><dl class="simple">
<dt>solventDielectric:</dt><dd><ul>
<li><p>dielectric constant of solvent regions</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>soluteDielectric:</dt><dd><ul>
<li><p>dielectric constant “inside” the macromolecule</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>SA:</dt><dd><ul>
<li><p>string choosing the method for determining solvent-accessible
surface</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>cutoff:</dt><dd><ul>
<li><p>cutoff distance in nanometres (must match the cutoff distance
for the other nonbonded forces in the simulation!)</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>kappa:</dt><dd><ul>
<li><p>Determines the rate of falloff of the potential with distance.
Effectively a proxy for salt concentration, where higher kappa
corresponds to higher salt.</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>nonbonded_method:</dt><dd><ul>
<li><p>should be left as default in almost all cases.</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</dd>
</dl>
</dd></dl>

</dd></dl>

</div></blockquote>
</div>
</div>
</div>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h3><a href="../isolde.html">Table of Contents</a></h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../isolde.html">Home</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tools/ISOLDE.html">The ISOLDE GUI</a></li>
<li class="toctree-l1"><a class="reference internal" href="../commands/isolde.html">The ISOLDE Command Line</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="isolde.html">ISOLDE Python API</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="gui_control.html">Accessing ISOLDE GUI functions from Python</a></li>
<li class="toctree-l2"><a class="reference internal" href="core_objects.html">Core Dihedral Classes</a></li>
<li class="toctree-l2"><a class="reference internal" href="interpolation.html"><em>n</em>-Dimensional Interpolation</a></li>
<li class="toctree-l2"><a class="reference internal" href="live_validation.html">Live Structure Validation</a></li>
<li class="toctree-l2"><a class="reference internal" href="restraints.html">Restraints and Steering Forces</a></li>
<li class="toctree-l2"><a class="reference internal" href="scripted_manipulations.html">(Semi-)Automated Manipulations</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="sim_management.html#">Simulation Setup and Management</a></li>
<li class="toctree-l2"><a class="reference internal" href="utils.html">General Utilities</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../tools/license.html">License</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tools/citing.html">Citing ISOLDE</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tools/contact.html">Contact Info</a></li>
</ul>
<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../isolde.html">Documentation overview</a><ul>
  <li><a href="isolde.html">ISOLDE Python API</a><ul>
      <li>Previous: <a href="scripted_manipulations.html" title="previous chapter">(Semi-)Automated Manipulations</a></li>
      <li>Next: <a href="utils.html" title="next chapter">General Utilities</a></li>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2016-2019, Tristan Croll.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 2.2.0</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="../_sources/api/sim_management.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>